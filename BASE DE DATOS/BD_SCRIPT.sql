create database GestionPersonalProinsa

USE [GestionPersonalProinsa]
GO
/****** Object:  UserDefinedFunction [dbo].[CalcularDias]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[CalcularDias] (
    @INICIO DATE,
    @FIN DATE
)
RETURNS INT
AS
BEGIN
    DECLARE @BusinessDays INT;

    WITH FECHASRANGO AS (
        SELECT @INICIO AS DateValue
        UNION ALL
        SELECT DATEADD(DAY, 1, DateValue)
        FROM FECHASRANGO 
        WHERE DateValue < @FIN
    )
    SELECT @BusinessDays = COUNT(*)
    FROM FECHASRANGO 
    WHERE DateValue >= @INICIO AND DateValue <= @FIN -- Dentro del rango de fechas
        AND DATEPART(WEEKDAY, DateValue) NOT IN (1, 7); -- Excluye domingos (1) y s�bados (7)

    RETURN @BusinessDays;
END;
GO
/****** Object:  Table [dbo].[__EFMigrationsHistory]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[__EFMigrationsHistory](
	[MigrationId] [nvarchar](150) NOT NULL,
	[ProductVersion] [nvarchar](32) NOT NULL,
 CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY CLUSTERED 
(
	[MigrationId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[APROBACIONSOLICITUD]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[APROBACIONSOLICITUD](
	[ID_APROBACIONSOLICITUD] [bigint] IDENTITY(1,1) NOT NULL,
	[FECHA_APROBACIONSOLICITUD] [datetime] NULL,
	[SECUENCIA] [int] NULL,
	[RESPUESTA_SOLICITUD] [char](10) NOT NULL,
	[COMENTARIO] [varchar](200) NULL,
	[ENCARGADO_APROBACION_ID] [bigint] NOT NULL,
	[SOLICITUD_ID] [bigint] NOT NULL,
 CONSTRAINT [PK_APROBACIONSOLICITUD_ID] PRIMARY KEY CLUSTERED 
(
	[ID_APROBACIONSOLICITUD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AspNetRoleClaims]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetRoleClaims](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[RoleId] [nvarchar](450) NOT NULL,
	[ClaimType] [nvarchar](max) NULL,
	[ClaimValue] [nvarchar](max) NULL,
 CONSTRAINT [PK_AspNetRoleClaims] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AspNetRoles]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetRoles](
	[Id] [nvarchar](450) NOT NULL,
	[Name] [nvarchar](256) NULL,
	[NormalizedName] [nvarchar](256) NULL,
	[ConcurrencyStamp] [nvarchar](max) NULL,
 CONSTRAINT [PK_AspNetRoles] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AspNetUserClaims]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetUserClaims](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [nvarchar](450) NOT NULL,
	[ClaimType] [nvarchar](max) NULL,
	[ClaimValue] [nvarchar](max) NULL,
 CONSTRAINT [PK_AspNetUserClaims] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AspNetUserLogins]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetUserLogins](
	[LoginProvider] [nvarchar](450) NOT NULL,
	[ProviderKey] [nvarchar](450) NOT NULL,
	[ProviderDisplayName] [nvarchar](max) NULL,
	[UserId] [nvarchar](450) NOT NULL,
 CONSTRAINT [PK_AspNetUserLogins] PRIMARY KEY CLUSTERED 
(
	[LoginProvider] ASC,
	[ProviderKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AspNetUserRoles]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetUserRoles](
	[UserId] [nvarchar](450) NOT NULL,
	[RoleId] [nvarchar](450) NOT NULL,
 CONSTRAINT [PK_AspNetUserRoles] PRIMARY KEY CLUSTERED 
(
	[UserId] ASC,
	[RoleId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AspNetUsers]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetUsers](
	[Id] [nvarchar](450) NOT NULL,
	[UserName] [nvarchar](256) NULL,
	[NormalizedUserName] [nvarchar](256) NULL,
	[Email] [nvarchar](256) NULL,
	[NormalizedEmail] [nvarchar](256) NULL,
	[EmailConfirmed] [bit] NOT NULL,
	[PasswordHash] [nvarchar](max) NULL,
	[SecurityStamp] [nvarchar](max) NULL,
	[ConcurrencyStamp] [nvarchar](max) NULL,
	[PhoneNumber] [nvarchar](max) NULL,
	[PhoneNumberConfirmed] [bit] NOT NULL,
	[TwoFactorEnabled] [bit] NOT NULL,
	[LockoutEnd] [datetimeoffset](7) NULL,
	[LockoutEnabled] [bit] NOT NULL,
	[AccessFailedCount] [int] NOT NULL,
 CONSTRAINT [PK_AspNetUsers] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AspNetUserTokens]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetUserTokens](
	[UserId] [nvarchar](450) NOT NULL,
	[LoginProvider] [nvarchar](450) NOT NULL,
	[Name] [nvarchar](450) NOT NULL,
	[Value] [nvarchar](max) NULL,
 CONSTRAINT [PK_AspNetUserTokens] PRIMARY KEY CLUSTERED 
(
	[UserId] ASC,
	[LoginProvider] ASC,
	[Name] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CAPACITACION]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CAPACITACION](
	[ID_CAPACION] [bigint] IDENTITY(1,1) NOT NULL,
	[DESCRIPCION] [varchar](100) NULL,
	[INSTITUCION] [varchar](100) NULL,
	[LINK] [varchar](100) NULL,
	[CERTIFICACION] [varchar](100) NULL,
	[FECHA_FINALIZACION] [datetime] NULL,
	[CANTIDAD_HORAS] [int] NULL,
	[ESTADO] [bit] NULL,
 CONSTRAINT [PK_CAPACITACION_ID] PRIMARY KEY CLUSTERED 
(
	[ID_CAPACION] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CARGO]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CARGO](
	[ID_CARGO] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBRE_CARGO] [varchar](50) NULL,
	[DESCRIPCION] [varchar](200) NULL,
 CONSTRAINT [PK_CARGO_ID] PRIMARY KEY CLUSTERED 
(
	[ID_CARGO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CORREO]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CORREO](
	[ID_CORREO] [bigint] IDENTITY(1,1) NOT NULL,
	[CORREO] [varchar](255) NULL,
 CONSTRAINT [PK_CORREO_ID] PRIMARY KEY CLUSTERED 
(
	[ID_CORREO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DB_ERRORES]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DB_ERRORES](
	[ErrorID] [int] IDENTITY(1,1) NOT NULL,
	[UserName] [varchar](100) NULL,
	[ErrorNumber] [int] NULL,
	[ErrorState] [int] NULL,
	[ErrorSeverity] [int] NULL,
	[ErrorLine] [int] NULL,
	[ErrorProcedure] [varchar](max) NULL,
	[ErrorMessage] [varchar](max) NULL,
	[ErrorDateTime] [datetime] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DEDUCCION]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DEDUCCION](
	[ID_DEDUCCION] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBRE_INGRESO] [varchar](50) NULL,
	[DESCRIPCION] [varchar](200) NULL,
	[PORCENTAJE] [decimal](10, 2) NULL,
 CONSTRAINT [PK_DEDUCCION_ID] PRIMARY KEY CLUSTERED 
(
	[ID_DEDUCCION] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DEDUCCIONNOMINA]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DEDUCCIONNOMINA](
	[ID_DEDUCCIONNOMINA] [bigint] IDENTITY(1,1) NOT NULL,
	[MONTO] [decimal](10, 2) NULL,
	[DETALLE] [varchar](100) NULL,
	[DEDUCCION_ID] [bigint] NULL,
 CONSTRAINT [PK_DEDUCCIONNOMINA_ID] PRIMARY KEY CLUSTERED 
(
	[ID_DEDUCCIONNOMINA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DEPARTAMENTO]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DEPARTAMENTO](
	[ID_DEPARTAMENTO] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBRE_DEPARTAMENTO] [varchar](50) NULL,
	[DESCRIPCION] [varchar](100) NOT NULL,
 CONSTRAINT [PK_DEPARTAMENTO_ID] PRIMARY KEY CLUSTERED 
(
	[ID_DEPARTAMENTO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DEPARTAMENTOSUPERVISOR]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DEPARTAMENTOSUPERVISOR](
	[ID_DEPARTAMENTOSUPERVISOR] [bigint] IDENTITY(1,1) NOT NULL,
	[EMPLEADO_ID] [bigint] NOT NULL,
	[DEPARTAMENTO_ID] [bigint] NOT NULL,
 CONSTRAINT [PK_DEPARTAMENTOSUPERVISOR_ID] PRIMARY KEY CLUSTERED 
(
	[ID_DEPARTAMENTOSUPERVISOR] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DIRRECCION]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DIRRECCION](
	[ID_DIRECCION] [bigint] IDENTITY(1,1) NOT NULL,
	[DIRRECION] [varchar](600) NULL,
 CONSTRAINT [PK_DIRRECCION_ID] PRIMARY KEY CLUSTERED 
(
	[ID_DIRECCION] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EMPLEADO]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPLEADO](
	[ID_EMPLEADO] [bigint] IDENTITY(1,1) NOT NULL,
	[IDENTIFICACION] [int] NULL,
	[NOMBRECOMPLETO] [varchar](250) NULL,
	[FECHA_NACIMIENTO] [datetime] NULL,
	[FECHA_INGRESO] [datetime] NULL,
	[FOTO] [varchar](250) NULL,
	[SALARIO] [decimal](10, 2) NULL,
	[SALDO_VACACIONES] [int] NULL,
	[CARGO_ID] [bigint] NULL,
	[CORREO_ID] [bigint] NOT NULL,
	[HORARIOLABORAL_ID] [bigint] NULL,
	[DEPARTAMENTO_ID] [bigint] NULL,
	[ESTADO] [bit] NULL,
	[AspNetUsers_ID] [nvarchar](450) NULL,
 CONSTRAINT [PK_EMPLEADO_ID] PRIMARY KEY CLUSTERED 
(
	[ID_EMPLEADO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EMPLEADOCAPACITACION]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPLEADOCAPACITACION](
	[ID_EMPLEADOCAPACITACION] [bigint] IDENTITY(1,1) NOT NULL,
	[CAPACITACION_ID] [bigint] NOT NULL,
	[EMPLEADO_ID] [bigint] NOT NULL,
 CONSTRAINT [PK_EMPLEADOCAPACITACION_ID] PRIMARY KEY CLUSTERED 
(
	[ID_EMPLEADOCAPACITACION] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EMPLEADODIRRECCION]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPLEADODIRRECCION](
	[ID_EMPLEADODIRRECCION] [bigint] IDENTITY(1,1) NOT NULL,
	[EMPLEADO_ID] [bigint] NOT NULL,
	[DIRRECION_ID] [bigint] NOT NULL,
 CONSTRAINT [PK_EMPLEADODIRRECCION_ID] PRIMARY KEY CLUSTERED 
(
	[ID_EMPLEADODIRRECCION] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EMPLEADODOCUMENTO]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPLEADODOCUMENTO](
	[ID_EMPLEADODOCUMENTO] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBRE_DOCUMENTO] [varchar](50) NULL,
	[COMENTARIO] [varchar](200) NULL,
	[TIPODOCUMENTO_ID] [bigint] NULL,
	[EMPLEADO_ID] [bigint] NULL,
 CONSTRAINT [PK_EMPLEADODOCUMENTO_ID] PRIMARY KEY CLUSTERED 
(
	[ID_EMPLEADODOCUMENTO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EMPLEADOTELEFONO]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPLEADOTELEFONO](
	[ID_EMPLEADOTELEFONO] [bigint] IDENTITY(1,1) NOT NULL,
	[EMPLEADO_ID] [bigint] NOT NULL,
	[TELEFONO_ID] [bigint] NOT NULL,
 CONSTRAINT [PK_EMPLEADOTELEFONO_ID] PRIMARY KEY CLUSTERED 
(
	[ID_EMPLEADOTELEFONO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[FLUJOAPROBACION]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FLUJOAPROBACION](
	[ID_FLUJOAPROBACION] [bigint] IDENTITY(1,1) NOT NULL,
	[SECUENCIA] [int] NOT NULL,
	[DEPARTAMENTO_APROBACION_ID] [bigint] NULL,
	[DEPARTAMENTO_ID] [bigint] NOT NULL,
 CONSTRAINT [PK_FLUJOAPROBACION_ID] PRIMARY KEY CLUSTERED 
(
	[ID_FLUJOAPROBACION] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[HORARIOLABORAL]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HORARIOLABORAL](
	[ID_HORARIOLABORAL] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBREHL] [varchar](50) NOT NULL,
	[DESCRIPCION] [varchar](200) NULL,
	[HORA_INGRESO] [int] NULL,
	[HORA_SALIDA] [int] NULL,
 CONSTRAINT [PK_HORARIOLABORAL_ID] PRIMARY KEY CLUSTERED 
(
	[ID_HORARIOLABORAL] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[INGRESO]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[INGRESO](
	[ID_INGRESO] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBRE_INGRESO] [varchar](50) NOT NULL,
	[DESCRIPCION] [varchar](200) NULL,
	[MONTO] [decimal](10, 2) NULL,
	[PORCENTAJE] [decimal](10, 2) NULL,
 CONSTRAINT [PK_INGRESO_ID] PRIMARY KEY CLUSTERED 
(
	[ID_INGRESO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[INGRESONOMINA]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[INGRESONOMINA](
	[ID_INGRESONOMINA] [bigint] IDENTITY(1,1) NOT NULL,
	[MONTO] [decimal](10, 2) NULL,
	[DETALLE] [varchar](100) NULL,
	[INGRESO_ID] [bigint] NULL,
 CONSTRAINT [PK_INGRESONOMINA_ID] PRIMARY KEY CLUSTERED 
(
	[ID_INGRESONOMINA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[NOMINA]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[NOMINA](
	[ID_NOMINA] [bigint] IDENTITY(1,1) NOT NULL,
	[DESCRIPCION] [varchar](100) NULL,
	[PERIODO] [varchar](50) NULL,
	[FECHA_CALCULO] [datetime] NULL,
	[FECHA_PAGO] [datetime] NULL,
	[OBSERVACIONES] [varchar](500) NULL,
	[REVISIONES] [int] NULL,
	[FECHACREACION] [datetime] NULL,
	[FECHACAPROBACION] [datetime] NULL,
	[ESTADO] [bit] NULL,
	[HORAS_TRABAJADAS] [int] NULL,
	[HORAS_EXTRA] [int] NULL,
	[SALARIO_BRUTO] [decimal](10, 2) NULL,
	[SALARIO_NETO] [decimal](10, 2) NULL,
	[INGRESONOMINA_ID] [bigint] NOT NULL,
	[DEDUCCIONNOMINA_ID] [bigint] NOT NULL,
	[EMPLEADO_ID] [bigint] NOT NULL,
	[TIPONOMINA_ID] [bigint] NULL,
	[CREADOR_ID] [bigint] NULL,
	[APROBADOR_ID] [bigint] NULL,
 CONSTRAINT [PK_NOMINA_ID] PRIMARY KEY CLUSTERED 
(
	[ID_NOMINA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[REGISTROACTIVIDAD]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[REGISTROACTIVIDAD](
	[ID_REGISTROACTIVIDAD] [bigint] IDENTITY(1,1) NOT NULL,
	[FECHA_INICIO] [datetime] NULL,
	[FECHA_FINAL] [datetime] NULL,
	[DETALLE] [varchar](500) NULL,
	[TIPOACTIVIDAD_ID] [bigint] NOT NULL,
	[EMPLEADO_ID] [bigint] NOT NULL,
 CONSTRAINT [PK_REGISTROACTIVIDAD_ID] PRIMARY KEY CLUSTERED 
(
	[ID_REGISTROACTIVIDAD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SOLICITUD]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SOLICITUD](
	[ID_SOLICITUD] [bigint] IDENTITY(1,1) NOT NULL,
	[FECHA_SOLICITUD] [datetime] NOT NULL,
	[FECHA_INICIO] [datetime] NULL,
	[FECHA_FINAL] [datetime] NULL,
	[COMENTARIO] [varchar](200) NULL,
	[DIAS] [int] NULL,
	[DETALLE] [varchar](300) NULL,
	[ESTADO_SOLICITUD] [char](10) NULL,
	[SOLICITANTE_ID] [bigint] NOT NULL,
	[TIPOSOLICITUD_ID] [bigint] NOT NULL,
	[ID_HORARIOLABORAL] [bigint] NULL,
 CONSTRAINT [PK_SOLICITUD_ID] PRIMARY KEY CLUSTERED 
(
	[ID_SOLICITUD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TELEFONO]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TELEFONO](
	[ID_TELEFONO] [bigint] IDENTITY(1,1) NOT NULL,
	[TELEFONO] [varchar](22) NULL,
 CONSTRAINT [PK_TELEFONO_ID] PRIMARY KEY CLUSTERED 
(
	[ID_TELEFONO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TIPOACTIVIDAD]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TIPOACTIVIDAD](
	[ID_TIPOACTIVIDAD] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBRE_TIPO_CTIVIDAD] [varchar](50) NULL,
	[DESCRIPCION] [varchar](100) NULL,
 CONSTRAINT [PK_TIPOACTIVIDAD_ID] PRIMARY KEY CLUSTERED 
(
	[ID_TIPOACTIVIDAD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TIPODOCUMENTO]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TIPODOCUMENTO](
	[ID_TIPODOCUMENTO] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBRE_TIPODOCUMENTO] [varchar](50) NOT NULL,
	[DESCRIPCION] [varchar](200) NULL,
 CONSTRAINT [PK_TIPODOCUMENTO_ID] PRIMARY KEY CLUSTERED 
(
	[ID_TIPODOCUMENTO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TIPONOMINA]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TIPONOMINA](
	[ID_TIPONOMINA] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBRE_NOMINA] [varchar](50) NULL,
	[DESCRIPCION] [varchar](200) NULL,
 CONSTRAINT [PK_TIPONOMINA_ID] PRIMARY KEY CLUSTERED 
(
	[ID_TIPONOMINA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TIPOSOLICITUD]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TIPOSOLICITUD](
	[ID_TIPOSOLICITUD] [bigint] IDENTITY(1,1) NOT NULL,
	[NOMBRE_TIPO_SOLICITUD] [varchar](50) NULL,
	[DESCRIPCION] [varchar](100) NULL,
 CONSTRAINT [PK_TIPOSOLICITUD_ID] PRIMARY KEY CLUSTERED 
(
	[ID_TIPOSOLICITUD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
SET IDENTITY_INSERT [dbo].[APROBACIONSOLICITUD] ON 

INSERT [dbo].[APROBACIONSOLICITUD] ([ID_APROBACIONSOLICITUD], [FECHA_APROBACIONSOLICITUD], [SECUENCIA], [RESPUESTA_SOLICITUD], [COMENTARIO], [ENCARGADO_APROBACION_ID], [SOLICITUD_ID]) VALUES (1, NULL, 2, N'P         ', NULL, 2, 3)
INSERT [dbo].[APROBACIONSOLICITUD] ([ID_APROBACIONSOLICITUD], [FECHA_APROBACIONSOLICITUD], [SECUENCIA], [RESPUESTA_SOLICITUD], [COMENTARIO], [ENCARGADO_APROBACION_ID], [SOLICITUD_ID]) VALUES (2, NULL, 1, N'P         ', NULL, 3, 4)
INSERT [dbo].[APROBACIONSOLICITUD] ([ID_APROBACIONSOLICITUD], [FECHA_APROBACIONSOLICITUD], [SECUENCIA], [RESPUESTA_SOLICITUD], [COMENTARIO], [ENCARGADO_APROBACION_ID], [SOLICITUD_ID]) VALUES (3, NULL, 2, N'P         ', NULL, 2, 4)
INSERT [dbo].[APROBACIONSOLICITUD] ([ID_APROBACIONSOLICITUD], [FECHA_APROBACIONSOLICITUD], [SECUENCIA], [RESPUESTA_SOLICITUD], [COMENTARIO], [ENCARGADO_APROBACION_ID], [SOLICITUD_ID]) VALUES (4, NULL, 1, N'P         ', NULL, 3, 5)
INSERT [dbo].[APROBACIONSOLICITUD] ([ID_APROBACIONSOLICITUD], [FECHA_APROBACIONSOLICITUD], [SECUENCIA], [RESPUESTA_SOLICITUD], [COMENTARIO], [ENCARGADO_APROBACION_ID], [SOLICITUD_ID]) VALUES (5, NULL, 2, N'P         ', NULL, 2, 5)
SET IDENTITY_INSERT [dbo].[APROBACIONSOLICITUD] OFF
GO
INSERT [dbo].[AspNetRoles] ([Id], [Name], [NormalizedName], [ConcurrencyStamp]) VALUES (N'1', N'ADMINISTRADOR', N'ADMINISTRADOR', N'')
INSERT [dbo].[AspNetRoles] ([Id], [Name], [NormalizedName], [ConcurrencyStamp]) VALUES (N'2', N'RECURSOS HUMANOS', N'RECURSOS HUMANOS', N'')
INSERT [dbo].[AspNetRoles] ([Id], [Name], [NormalizedName], [ConcurrencyStamp]) VALUES (N'3', N'EMPLEADO', N'EMPLEADO', NULL)
GO
INSERT [dbo].[AspNetUserLogins] ([LoginProvider], [ProviderKey], [ProviderDisplayName], [UserId]) VALUES (N'Microsoft', N'369d841c-b981-4a4d-b408-56902a92632b', N'Microsoft', N'18127048-4b04-4a5d-8c78-556b315649d7')
INSERT [dbo].[AspNetUserLogins] ([LoginProvider], [ProviderKey], [ProviderDisplayName], [UserId]) VALUES (N'Microsoft', N'c70b66ca-96a1-4238-8a83-110f1d7e46ed', N'Microsoft', N'68890dd1-80fc-4c65-9481-f5a1275897ec')
GO
INSERT [dbo].[AspNetUserRoles] ([UserId], [RoleId]) VALUES (N'18127048-4b04-4a5d-8c78-556b315649d7', N'1')
INSERT [dbo].[AspNetUserRoles] ([UserId], [RoleId]) VALUES (N'68890dd1-80fc-4c65-9481-f5a1275897ec', N'1')
GO
INSERT [dbo].[AspNetUsers] ([Id], [UserName], [NormalizedUserName], [Email], [NormalizedEmail], [EmailConfirmed], [PasswordHash], [SecurityStamp], [ConcurrencyStamp], [PhoneNumber], [PhoneNumberConfirmed], [TwoFactorEnabled], [LockoutEnd], [LockoutEnabled], [AccessFailedCount]) VALUES (N'18127048-4b04-4a5d-8c78-556b315649d7', N'Practicante1@proinsalat.com', N'PRACTICANTE1@PROINSALAT.COM', N'Practicante1@proinsalat.com', N'PRACTICANTE1@PROINSALAT.COM', 0, NULL, N'SNXBJZO7YYRNUGAWFG6WTIGNXVO6GV5Y', N'fcf65fb7-f741-43a8-b952-abd19ddd14a5', NULL, 0, 0, NULL, 1, 0)
INSERT [dbo].[AspNetUsers] ([Id], [UserName], [NormalizedUserName], [Email], [NormalizedEmail], [EmailConfirmed], [PasswordHash], [SecurityStamp], [ConcurrencyStamp], [PhoneNumber], [PhoneNumberConfirmed], [TwoFactorEnabled], [LockoutEnd], [LockoutEnabled], [AccessFailedCount]) VALUES (N'68890dd1-80fc-4c65-9481-f5a1275897ec', N'tcamacho@proinsalat.com', N'TCAMACHO@PROINSALAT.COM', N'tcamacho@proinsalat.com', N'TCAMACHO@PROINSALAT.COM', 0, NULL, N'PLBWFLLIIWIZE4HX2F5VACRBK2U2Q6KK', N'0c2f56a4-d4a9-4cd8-bc37-a8f09bffcb9f', NULL, 0, 0, NULL, 1, 0)
GO
SET IDENTITY_INSERT [dbo].[CARGO] ON 

INSERT [dbo].[CARGO] ([ID_CARGO], [NOMBRE_CARGO], [DESCRIPCION]) VALUES (1, N'CONSULTING MANAGER', N'CONSULTING MANAGER')
INSERT [dbo].[CARGO] ([ID_CARGO], [NOMBRE_CARGO], [DESCRIPCION]) VALUES (2, N'SOFTWARE DEVELOPER', N'SOFTWARE DEVELOPER')
INSERT [dbo].[CARGO] ([ID_CARGO], [NOMBRE_CARGO], [DESCRIPCION]) VALUES (3, N'CONSULTOR', N'CONSULTOR')
INSERT [dbo].[CARGO] ([ID_CARGO], [NOMBRE_CARGO], [DESCRIPCION]) VALUES (4, N'SUPPORT', N'SUPPORT')
INSERT [dbo].[CARGO] ([ID_CARGO], [NOMBRE_CARGO], [DESCRIPCION]) VALUES (5, N'SOFTWARE DEVELOPMENT MANAGER', N'SOFTWARE DEVELOPMENT MANAGER')
SET IDENTITY_INSERT [dbo].[CARGO] OFF
GO
SET IDENTITY_INSERT [dbo].[CORREO] ON 

INSERT [dbo].[CORREO] ([ID_CORREO], [CORREO]) VALUES (2, N'Practicante1@proinsalat.com')
INSERT [dbo].[CORREO] ([ID_CORREO], [CORREO]) VALUES (3, N'tcamacho@proinsalat.com')
SET IDENTITY_INSERT [dbo].[CORREO] OFF
GO
SET IDENTITY_INSERT [dbo].[DB_ERRORES] ON 

INSERT [dbo].[DB_ERRORES] ([ErrorID], [UserName], [ErrorNumber], [ErrorState], [ErrorSeverity], [ErrorLine], [ErrorProcedure], [ErrorMessage], [ErrorDateTime]) VALUES (1, N'PROINSA\tcamacho', 515, 2, 16, 32, N'dbo.RegistrarAprobaciones', N'Cannot insert the value NULL into column ''FECHA_APROBACIONSOLICITUD'', table ''GestionPersonalProinsa10.dbo.APROBACIONSOLICITUD''; column does not allow nulls. INSERT fails.', CAST(N'2024-06-29T15:24:18.683' AS DateTime))
INSERT [dbo].[DB_ERRORES] ([ErrorID], [UserName], [ErrorNumber], [ErrorState], [ErrorSeverity], [ErrorLine], [ErrorProcedure], [ErrorMessage], [ErrorDateTime]) VALUES (2, N'PROINSA\tcamacho', 14624, 1, 16, 260, N'msdb.dbo.sp_send_dbmail', N'At least one of the following parameters must be specified. "@recipients, @copy_recipients, @blind_copy_recipients".', CAST(N'2024-06-29T15:27:45.267' AS DateTime))
INSERT [dbo].[DB_ERRORES] ([ErrorID], [UserName], [ErrorNumber], [ErrorState], [ErrorSeverity], [ErrorLine], [ErrorProcedure], [ErrorMessage], [ErrorDateTime]) VALUES (3, N'sa', 14624, 1, 16, 260, N'msdb.dbo.sp_send_dbmail', N'At least one of the following parameters must be specified. "@recipients, @copy_recipients, @blind_copy_recipients".', CAST(N'2024-06-29T16:09:21.687' AS DateTime))
INSERT [dbo].[DB_ERRORES] ([ErrorID], [UserName], [ErrorNumber], [ErrorState], [ErrorSeverity], [ErrorLine], [ErrorProcedure], [ErrorMessage], [ErrorDateTime]) VALUES (4, N'sa', 14624, 1, 16, 260, N'msdb.dbo.sp_send_dbmail', N'At least one of the following parameters must be specified. "@recipients, @copy_recipients, @blind_copy_recipients".', CAST(N'2024-06-29T16:11:29.253' AS DateTime))
INSERT [dbo].[DB_ERRORES] ([ErrorID], [UserName], [ErrorNumber], [ErrorState], [ErrorSeverity], [ErrorLine], [ErrorProcedure], [ErrorMessage], [ErrorDateTime]) VALUES (5, N'sa', 14624, 1, 16, 260, N'msdb.dbo.sp_send_dbmail', N'At least one of the following parameters must be specified. "@recipients, @copy_recipients, @blind_copy_recipients".', CAST(N'2024-06-29T16:11:42.267' AS DateTime))
SET IDENTITY_INSERT [dbo].[DB_ERRORES] OFF
GO
SET IDENTITY_INSERT [dbo].[DEPARTAMENTO] ON 

INSERT [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO], [NOMBRE_DEPARTAMENTO], [DESCRIPCION]) VALUES (1, N'DESARROLLO', N'SOFTWARE DEVELOPMENT')
INSERT [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO], [NOMBRE_DEPARTAMENTO], [DESCRIPCION]) VALUES (2, N'CONSULTORIA', N'CONSULTORIA')
INSERT [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO], [NOMBRE_DEPARTAMENTO], [DESCRIPCION]) VALUES (3, N'SOPORTE ', N'SOPORTE')
INSERT [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO], [NOMBRE_DEPARTAMENTO], [DESCRIPCION]) VALUES (4, N'OPERACIONES', N'OPERACIONES')
INSERT [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO], [NOMBRE_DEPARTAMENTO], [DESCRIPCION]) VALUES (5, N'SERVICIO AL CLIENTE', N'SERVICIO AL CLIENTE')
INSERT [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO], [NOMBRE_DEPARTAMENTO], [DESCRIPCION]) VALUES (6, N'GERENCIA GENERAL', N'GERERENCIA GENERAL')
INSERT [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO], [NOMBRE_DEPARTAMENTO], [DESCRIPCION]) VALUES (7, N'FINANZAS', N'FINANZAS')
INSERT [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO], [NOMBRE_DEPARTAMENTO], [DESCRIPCION]) VALUES (8, N'RECURSOS HUMANOS', N'RECURSOS HUMANOS')
SET IDENTITY_INSERT [dbo].[DEPARTAMENTO] OFF
GO
SET IDENTITY_INSERT [dbo].[DEPARTAMENTOSUPERVISOR] ON 

INSERT [dbo].[DEPARTAMENTOSUPERVISOR] ([ID_DEPARTAMENTOSUPERVISOR], [EMPLEADO_ID], [DEPARTAMENTO_ID]) VALUES (1, 2, 2)
INSERT [dbo].[DEPARTAMENTOSUPERVISOR] ([ID_DEPARTAMENTOSUPERVISOR], [EMPLEADO_ID], [DEPARTAMENTO_ID]) VALUES (2, 3, 1)
SET IDENTITY_INSERT [dbo].[DEPARTAMENTOSUPERVISOR] OFF
GO
SET IDENTITY_INSERT [dbo].[DIRRECCION] ON 

INSERT [dbo].[DIRRECCION] ([ID_DIRECCION], [DIRRECION]) VALUES (1, N'Tejar , El guarco , Cartago')
INSERT [dbo].[DIRRECCION] ([ID_DIRECCION], [DIRRECION]) VALUES (2, N'Cristo Rey , San Cristobal , San José')
SET IDENTITY_INSERT [dbo].[DIRRECCION] OFF
GO
SET IDENTITY_INSERT [dbo].[EMPLEADO] ON 

INSERT [dbo].[EMPLEADO] ([ID_EMPLEADO], [IDENTIFICACION], [NOMBRECOMPLETO], [FECHA_NACIMIENTO], [FECHA_INGRESO], [FOTO], [SALARIO], [SALDO_VACACIONES], [CARGO_ID], [CORREO_ID], [HORARIOLABORAL_ID], [DEPARTAMENTO_ID], [ESTADO], [AspNetUsers_ID]) VALUES (2, 305070198, N'PRACTICANTE', CAST(N'1999-01-01T00:00:00.000' AS DateTime), CAST(N'2023-01-01T00:00:00.000' AS DateTime), N'N', CAST(500.00 AS Decimal(10, 2)), 12, 1, 2, 1, 2, 1, N'18127048-4b04-4a5d-8c78-556b315649d7')
INSERT [dbo].[EMPLEADO] ([ID_EMPLEADO], [IDENTIFICACION], [NOMBRECOMPLETO], [FECHA_NACIMIENTO], [FECHA_INGRESO], [FOTO], [SALARIO], [SALDO_VACACIONES], [CARGO_ID], [CORREO_ID], [HORARIOLABORAL_ID], [DEPARTAMENTO_ID], [ESTADO], [AspNetUsers_ID]) VALUES (3, 305070198, N'TIFANNY CAMACHO', CAST(N'1999-01-01T00:00:00.000' AS DateTime), CAST(N'2023-01-01T00:00:00.000' AS DateTime), N'N', CAST(500.00 AS Decimal(10, 2)), 12, 5, 3, 1, 1, 1, N'68890dd1-80fc-4c65-9481-f5a1275897ec')
SET IDENTITY_INSERT [dbo].[EMPLEADO] OFF
GO
SET IDENTITY_INSERT [dbo].[EMPLEADODIRRECCION] ON 

INSERT [dbo].[EMPLEADODIRRECCION] ([ID_EMPLEADODIRRECCION], [EMPLEADO_ID], [DIRRECION_ID]) VALUES (1, 2, 1)
INSERT [dbo].[EMPLEADODIRRECCION] ([ID_EMPLEADODIRRECCION], [EMPLEADO_ID], [DIRRECION_ID]) VALUES (2, 3, 2)
SET IDENTITY_INSERT [dbo].[EMPLEADODIRRECCION] OFF
GO
SET IDENTITY_INSERT [dbo].[EMPLEADOTELEFONO] ON 

INSERT [dbo].[EMPLEADOTELEFONO] ([ID_EMPLEADOTELEFONO], [EMPLEADO_ID], [TELEFONO_ID]) VALUES (1, 2, 1)
INSERT [dbo].[EMPLEADOTELEFONO] ([ID_EMPLEADOTELEFONO], [EMPLEADO_ID], [TELEFONO_ID]) VALUES (2, 2, 2)
INSERT [dbo].[EMPLEADOTELEFONO] ([ID_EMPLEADOTELEFONO], [EMPLEADO_ID], [TELEFONO_ID]) VALUES (3, 3, 3)
INSERT [dbo].[EMPLEADOTELEFONO] ([ID_EMPLEADOTELEFONO], [EMPLEADO_ID], [TELEFONO_ID]) VALUES (4, 3, 4)
SET IDENTITY_INSERT [dbo].[EMPLEADOTELEFONO] OFF
GO
SET IDENTITY_INSERT [dbo].[FLUJOAPROBACION] ON 

INSERT [dbo].[FLUJOAPROBACION] ([ID_FLUJOAPROBACION], [SECUENCIA], [DEPARTAMENTO_APROBACION_ID], [DEPARTAMENTO_ID]) VALUES (1, 1, 1, 1)
INSERT [dbo].[FLUJOAPROBACION] ([ID_FLUJOAPROBACION], [SECUENCIA], [DEPARTAMENTO_APROBACION_ID], [DEPARTAMENTO_ID]) VALUES (3, 2, 1, 2)
SET IDENTITY_INSERT [dbo].[FLUJOAPROBACION] OFF
GO
SET IDENTITY_INSERT [dbo].[HORARIOLABORAL] ON 

INSERT [dbo].[HORARIOLABORAL] ([ID_HORARIOLABORAL], [NOMBREHL], [DESCRIPCION], [HORA_INGRESO], [HORA_SALIDA]) VALUES (1, N'JORNADA HABITUAL', N'JORNADA HABITUAL', 8, 17)
INSERT [dbo].[HORARIOLABORAL] ([ID_HORARIOLABORAL], [NOMBREHL], [DESCRIPCION], [HORA_INGRESO], [HORA_SALIDA]) VALUES (2, N'HORARIO TARDE', N'HORARIO TARDE', 13, 18)
INSERT [dbo].[HORARIOLABORAL] ([ID_HORARIOLABORAL], [NOMBREHL], [DESCRIPCION], [HORA_INGRESO], [HORA_SALIDA]) VALUES (3, N'HORARIO NOCHE', N'HORARIO NOCHE', 16, 22)
SET IDENTITY_INSERT [dbo].[HORARIOLABORAL] OFF
GO
SET IDENTITY_INSERT [dbo].[SOLICITUD] ON 

INSERT [dbo].[SOLICITUD] ([ID_SOLICITUD], [FECHA_SOLICITUD], [FECHA_INICIO], [FECHA_FINAL], [COMENTARIO], [DIAS], [DETALLE], [ESTADO_SOLICITUD], [SOLICITANTE_ID], [TIPOSOLICITUD_ID], [ID_HORARIOLABORAL]) VALUES (1, CAST(N'2024-06-29T15:21:54.443' AS DateTime), NULL, NULL, N'KKK', NULL, N'KKK', N'P         ', 3, 4, 2)
INSERT [dbo].[SOLICITUD] ([ID_SOLICITUD], [FECHA_SOLICITUD], [FECHA_INICIO], [FECHA_FINAL], [COMENTARIO], [DIAS], [DETALLE], [ESTADO_SOLICITUD], [SOLICITANTE_ID], [TIPOSOLICITUD_ID], [ID_HORARIOLABORAL]) VALUES (2, CAST(N'2024-06-29T15:24:18.663' AS DateTime), CAST(N'2024-06-20T00:00:00.000' AS DateTime), CAST(N'2024-06-26T00:00:00.000' AS DateTime), N'UU', 5, N'UUU', N'P         ', 3, 2, NULL)
INSERT [dbo].[SOLICITUD] ([ID_SOLICITUD], [FECHA_SOLICITUD], [FECHA_INICIO], [FECHA_FINAL], [COMENTARIO], [DIAS], [DETALLE], [ESTADO_SOLICITUD], [SOLICITANTE_ID], [TIPOSOLICITUD_ID], [ID_HORARIOLABORAL]) VALUES (3, CAST(N'2024-06-29T15:27:44.940' AS DateTime), CAST(N'2024-07-01T00:00:00.000' AS DateTime), CAST(N'2024-07-02T00:00:00.000' AS DateTime), N'UU', 2, N'UUUUU', N'P         ', 3, 1, NULL)
INSERT [dbo].[SOLICITUD] ([ID_SOLICITUD], [FECHA_SOLICITUD], [FECHA_INICIO], [FECHA_FINAL], [COMENTARIO], [DIAS], [DETALLE], [ESTADO_SOLICITUD], [SOLICITANTE_ID], [TIPOSOLICITUD_ID], [ID_HORARIOLABORAL]) VALUES (4, CAST(N'2024-06-29T16:15:37.790' AS DateTime), NULL, NULL, N'hh', NULL, N'hh', N'P         ', 3, 4, 2)
INSERT [dbo].[SOLICITUD] ([ID_SOLICITUD], [FECHA_SOLICITUD], [FECHA_INICIO], [FECHA_FINAL], [COMENTARIO], [DIAS], [DETALLE], [ESTADO_SOLICITUD], [SOLICITANTE_ID], [TIPOSOLICITUD_ID], [ID_HORARIOLABORAL]) VALUES (5, CAST(N'2024-06-29T16:23:03.110' AS DateTime), CAST(N'2024-06-14T00:00:00.000' AS DateTime), CAST(N'2024-06-21T00:00:00.000' AS DateTime), N'ee', 6, N'ee', N'P         ', 3, 1, NULL)
SET IDENTITY_INSERT [dbo].[SOLICITUD] OFF
GO
SET IDENTITY_INSERT [dbo].[TELEFONO] ON 

INSERT [dbo].[TELEFONO] ([ID_TELEFONO], [TELEFONO]) VALUES (1, N'000 000 000')
INSERT [dbo].[TELEFONO] ([ID_TELEFONO], [TELEFONO]) VALUES (2, N'000 000 000')
INSERT [dbo].[TELEFONO] ([ID_TELEFONO], [TELEFONO]) VALUES (3, N'000 000 000')
INSERT [dbo].[TELEFONO] ([ID_TELEFONO], [TELEFONO]) VALUES (4, N'000 000 001')
SET IDENTITY_INSERT [dbo].[TELEFONO] OFF
GO
SET IDENTITY_INSERT [dbo].[TIPOSOLICITUD] ON 

INSERT [dbo].[TIPOSOLICITUD] ([ID_TIPOSOLICITUD], [NOMBRE_TIPO_SOLICITUD], [DESCRIPCION]) VALUES (1, N'VACACIONES', N'VACACIONES')
INSERT [dbo].[TIPOSOLICITUD] ([ID_TIPOSOLICITUD], [NOMBRE_TIPO_SOLICITUD], [DESCRIPCION]) VALUES (2, N'PERMISO ESPECIAL', N'PERMISO ESPECIAL')
INSERT [dbo].[TIPOSOLICITUD] ([ID_TIPOSOLICITUD], [NOMBRE_TIPO_SOLICITUD], [DESCRIPCION]) VALUES (3, N'INCAPACIDAD', N'INCAPACIDAD')
INSERT [dbo].[TIPOSOLICITUD] ([ID_TIPOSOLICITUD], [NOMBRE_TIPO_SOLICITUD], [DESCRIPCION]) VALUES (4, N'CAMBIO DE HORARIO', N'CAMBIO DE HORARIO')
SET IDENTITY_INSERT [dbo].[TIPOSOLICITUD] OFF
GO
ALTER TABLE [dbo].[APROBACIONSOLICITUD]  WITH CHECK ADD  CONSTRAINT [FK_APROBACIONSOLICITUD_EMPLEADO] FOREIGN KEY([ENCARGADO_APROBACION_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[APROBACIONSOLICITUD] CHECK CONSTRAINT [FK_APROBACIONSOLICITUD_EMPLEADO]
GO
ALTER TABLE [dbo].[APROBACIONSOLICITUD]  WITH CHECK ADD  CONSTRAINT [FK_APROBACIONSOLICITUD_SOLICITUD] FOREIGN KEY([SOLICITUD_ID])
REFERENCES [dbo].[SOLICITUD] ([ID_SOLICITUD])
GO
ALTER TABLE [dbo].[APROBACIONSOLICITUD] CHECK CONSTRAINT [FK_APROBACIONSOLICITUD_SOLICITUD]
GO
ALTER TABLE [dbo].[AspNetRoleClaims]  WITH CHECK ADD  CONSTRAINT [FK_AspNetRoleClaims_AspNetRoles_RoleId] FOREIGN KEY([RoleId])
REFERENCES [dbo].[AspNetRoles] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetRoleClaims] CHECK CONSTRAINT [FK_AspNetRoleClaims_AspNetRoles_RoleId]
GO
ALTER TABLE [dbo].[AspNetUserClaims]  WITH CHECK ADD  CONSTRAINT [FK_AspNetUserClaims_AspNetUsers_UserId] FOREIGN KEY([UserId])
REFERENCES [dbo].[AspNetUsers] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetUserClaims] CHECK CONSTRAINT [FK_AspNetUserClaims_AspNetUsers_UserId]
GO
ALTER TABLE [dbo].[AspNetUserLogins]  WITH CHECK ADD  CONSTRAINT [FK_AspNetUserLogins_AspNetUsers_UserId] FOREIGN KEY([UserId])
REFERENCES [dbo].[AspNetUsers] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetUserLogins] CHECK CONSTRAINT [FK_AspNetUserLogins_AspNetUsers_UserId]
GO
ALTER TABLE [dbo].[AspNetUserRoles]  WITH CHECK ADD  CONSTRAINT [FK_AspNetUserRoles_AspNetRoles_RoleId] FOREIGN KEY([RoleId])
REFERENCES [dbo].[AspNetRoles] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetUserRoles] CHECK CONSTRAINT [FK_AspNetUserRoles_AspNetRoles_RoleId]
GO
ALTER TABLE [dbo].[AspNetUserRoles]  WITH CHECK ADD  CONSTRAINT [FK_AspNetUserRoles_AspNetUsers_UserId] FOREIGN KEY([UserId])
REFERENCES [dbo].[AspNetUsers] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetUserRoles] CHECK CONSTRAINT [FK_AspNetUserRoles_AspNetUsers_UserId]
GO
ALTER TABLE [dbo].[AspNetUserTokens]  WITH CHECK ADD  CONSTRAINT [FK_AspNetUserTokens_AspNetUsers_UserId] FOREIGN KEY([UserId])
REFERENCES [dbo].[AspNetUsers] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetUserTokens] CHECK CONSTRAINT [FK_AspNetUserTokens_AspNetUsers_UserId]
GO
ALTER TABLE [dbo].[DEDUCCIONNOMINA]  WITH CHECK ADD  CONSTRAINT [FK_DEDUCCIONNOMINA_DEDUCCION] FOREIGN KEY([DEDUCCION_ID])
REFERENCES [dbo].[DEDUCCION] ([ID_DEDUCCION])
GO
ALTER TABLE [dbo].[DEDUCCIONNOMINA] CHECK CONSTRAINT [FK_DEDUCCIONNOMINA_DEDUCCION]
GO
ALTER TABLE [dbo].[DEPARTAMENTOSUPERVISOR]  WITH CHECK ADD  CONSTRAINT [FK_DEPARTAMENTOSUPERVISOR_DEPARTAMENTO] FOREIGN KEY([DEPARTAMENTO_ID])
REFERENCES [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO])
GO
ALTER TABLE [dbo].[DEPARTAMENTOSUPERVISOR] CHECK CONSTRAINT [FK_DEPARTAMENTOSUPERVISOR_DEPARTAMENTO]
GO
ALTER TABLE [dbo].[DEPARTAMENTOSUPERVISOR]  WITH CHECK ADD  CONSTRAINT [FK_DEPARTAMENTOSUPERVISOR_EMPLEADO] FOREIGN KEY([EMPLEADO_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[DEPARTAMENTOSUPERVISOR] CHECK CONSTRAINT [FK_DEPARTAMENTOSUPERVISOR_EMPLEADO]
GO
ALTER TABLE [dbo].[EMPLEADO]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADO_AspNetUsers] FOREIGN KEY([AspNetUsers_ID])
REFERENCES [dbo].[AspNetUsers] ([Id])
GO
ALTER TABLE [dbo].[EMPLEADO] CHECK CONSTRAINT [FK_EMPLEADO_AspNetUsers]
GO
ALTER TABLE [dbo].[EMPLEADO]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADO_CARGO] FOREIGN KEY([CARGO_ID])
REFERENCES [dbo].[CARGO] ([ID_CARGO])
GO
ALTER TABLE [dbo].[EMPLEADO] CHECK CONSTRAINT [FK_EMPLEADO_CARGO]
GO
ALTER TABLE [dbo].[EMPLEADO]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADO_CORREO] FOREIGN KEY([CORREO_ID])
REFERENCES [dbo].[CORREO] ([ID_CORREO])
GO
ALTER TABLE [dbo].[EMPLEADO] CHECK CONSTRAINT [FK_EMPLEADO_CORREO]
GO
ALTER TABLE [dbo].[EMPLEADO]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADO_DEPARTAMENTO] FOREIGN KEY([DEPARTAMENTO_ID])
REFERENCES [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO])
GO
ALTER TABLE [dbo].[EMPLEADO] CHECK CONSTRAINT [FK_EMPLEADO_DEPARTAMENTO]
GO
ALTER TABLE [dbo].[EMPLEADO]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADO_HORARIOLABORAL] FOREIGN KEY([HORARIOLABORAL_ID])
REFERENCES [dbo].[HORARIOLABORAL] ([ID_HORARIOLABORAL])
GO
ALTER TABLE [dbo].[EMPLEADO] CHECK CONSTRAINT [FK_EMPLEADO_HORARIOLABORAL]
GO
ALTER TABLE [dbo].[EMPLEADOCAPACITACION]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADOCAPACITACION_CAPACITACION] FOREIGN KEY([CAPACITACION_ID])
REFERENCES [dbo].[CAPACITACION] ([ID_CAPACION])
GO
ALTER TABLE [dbo].[EMPLEADOCAPACITACION] CHECK CONSTRAINT [FK_EMPLEADOCAPACITACION_CAPACITACION]
GO
ALTER TABLE [dbo].[EMPLEADOCAPACITACION]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADOCAPACITACION_EMPLEADO] FOREIGN KEY([EMPLEADO_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[EMPLEADOCAPACITACION] CHECK CONSTRAINT [FK_EMPLEADOCAPACITACION_EMPLEADO]
GO
ALTER TABLE [dbo].[EMPLEADODIRRECCION]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADODIRRECCION_DIRECCION] FOREIGN KEY([DIRRECION_ID])
REFERENCES [dbo].[DIRRECCION] ([ID_DIRECCION])
GO
ALTER TABLE [dbo].[EMPLEADODIRRECCION] CHECK CONSTRAINT [FK_EMPLEADODIRRECCION_DIRECCION]
GO
ALTER TABLE [dbo].[EMPLEADODIRRECCION]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADODIRRECCION_EMPLEADO] FOREIGN KEY([EMPLEADO_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[EMPLEADODIRRECCION] CHECK CONSTRAINT [FK_EMPLEADODIRRECCION_EMPLEADO]
GO
ALTER TABLE [dbo].[EMPLEADODOCUMENTO]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADODOCUMENTO_EMPLEADO] FOREIGN KEY([EMPLEADO_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[EMPLEADODOCUMENTO] CHECK CONSTRAINT [FK_EMPLEADODOCUMENTO_EMPLEADO]
GO
ALTER TABLE [dbo].[EMPLEADODOCUMENTO]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADODOCUMENTO_TIPODOCUMENTO] FOREIGN KEY([TIPODOCUMENTO_ID])
REFERENCES [dbo].[TIPODOCUMENTO] ([ID_TIPODOCUMENTO])
GO
ALTER TABLE [dbo].[EMPLEADODOCUMENTO] CHECK CONSTRAINT [FK_EMPLEADODOCUMENTO_TIPODOCUMENTO]
GO
ALTER TABLE [dbo].[EMPLEADOTELEFONO]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADOTELEFONO_EMPLEADO] FOREIGN KEY([EMPLEADO_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[EMPLEADOTELEFONO] CHECK CONSTRAINT [FK_EMPLEADOTELEFONO_EMPLEADO]
GO
ALTER TABLE [dbo].[EMPLEADOTELEFONO]  WITH CHECK ADD  CONSTRAINT [FK_EMPLEADOTELEFONO_TELEFONO] FOREIGN KEY([TELEFONO_ID])
REFERENCES [dbo].[TELEFONO] ([ID_TELEFONO])
GO
ALTER TABLE [dbo].[EMPLEADOTELEFONO] CHECK CONSTRAINT [FK_EMPLEADOTELEFONO_TELEFONO]
GO
ALTER TABLE [dbo].[FLUJOAPROBACION]  WITH CHECK ADD  CONSTRAINT [FK_FLUJOAPROBACION_DEPARTAMENTO1] FOREIGN KEY([DEPARTAMENTO_APROBACION_ID])
REFERENCES [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO])
GO
ALTER TABLE [dbo].[FLUJOAPROBACION] CHECK CONSTRAINT [FK_FLUJOAPROBACION_DEPARTAMENTO1]
GO
ALTER TABLE [dbo].[FLUJOAPROBACION]  WITH CHECK ADD  CONSTRAINT [FK_FLUJOAPROBACION_DEPARTAMENTO2] FOREIGN KEY([DEPARTAMENTO_ID])
REFERENCES [dbo].[DEPARTAMENTO] ([ID_DEPARTAMENTO])
GO
ALTER TABLE [dbo].[FLUJOAPROBACION] CHECK CONSTRAINT [FK_FLUJOAPROBACION_DEPARTAMENTO2]
GO
ALTER TABLE [dbo].[INGRESONOMINA]  WITH CHECK ADD  CONSTRAINT [FK_INGRESONOMINA_INGRESO] FOREIGN KEY([INGRESO_ID])
REFERENCES [dbo].[INGRESO] ([ID_INGRESO])
GO
ALTER TABLE [dbo].[INGRESONOMINA] CHECK CONSTRAINT [FK_INGRESONOMINA_INGRESO]
GO
ALTER TABLE [dbo].[NOMINA]  WITH CHECK ADD  CONSTRAINT [FK_NOMINA_DEDUCCIONNOMINA] FOREIGN KEY([DEDUCCIONNOMINA_ID])
REFERENCES [dbo].[DEDUCCIONNOMINA] ([ID_DEDUCCIONNOMINA])
GO
ALTER TABLE [dbo].[NOMINA] CHECK CONSTRAINT [FK_NOMINA_DEDUCCIONNOMINA]
GO
ALTER TABLE [dbo].[NOMINA]  WITH CHECK ADD  CONSTRAINT [FK_NOMINA_EMPLEADO] FOREIGN KEY([EMPLEADO_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[NOMINA] CHECK CONSTRAINT [FK_NOMINA_EMPLEADO]
GO
ALTER TABLE [dbo].[NOMINA]  WITH CHECK ADD  CONSTRAINT [FK_NOMINA_EMPLEADO1] FOREIGN KEY([CREADOR_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[NOMINA] CHECK CONSTRAINT [FK_NOMINA_EMPLEADO1]
GO
ALTER TABLE [dbo].[NOMINA]  WITH CHECK ADD  CONSTRAINT [FK_NOMINA_EMPLEADO2] FOREIGN KEY([APROBADOR_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[NOMINA] CHECK CONSTRAINT [FK_NOMINA_EMPLEADO2]
GO
ALTER TABLE [dbo].[NOMINA]  WITH CHECK ADD  CONSTRAINT [FK_NOMINA_INGRESONOMINA] FOREIGN KEY([INGRESONOMINA_ID])
REFERENCES [dbo].[INGRESONOMINA] ([ID_INGRESONOMINA])
GO
ALTER TABLE [dbo].[NOMINA] CHECK CONSTRAINT [FK_NOMINA_INGRESONOMINA]
GO
ALTER TABLE [dbo].[NOMINA]  WITH CHECK ADD  CONSTRAINT [FK_NOMINA_TIPONOMINA] FOREIGN KEY([TIPONOMINA_ID])
REFERENCES [dbo].[TIPONOMINA] ([ID_TIPONOMINA])
GO
ALTER TABLE [dbo].[NOMINA] CHECK CONSTRAINT [FK_NOMINA_TIPONOMINA]
GO
ALTER TABLE [dbo].[REGISTROACTIVIDAD]  WITH CHECK ADD  CONSTRAINT [FK_REGISTROACTIVIDAD_EMPLEADO] FOREIGN KEY([EMPLEADO_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[REGISTROACTIVIDAD] CHECK CONSTRAINT [FK_REGISTROACTIVIDAD_EMPLEADO]
GO
ALTER TABLE [dbo].[REGISTROACTIVIDAD]  WITH CHECK ADD  CONSTRAINT [FK_REGISTROACTIVIDAD_TIPOACTIVIDAD] FOREIGN KEY([TIPOACTIVIDAD_ID])
REFERENCES [dbo].[TIPOACTIVIDAD] ([ID_TIPOACTIVIDAD])
GO
ALTER TABLE [dbo].[REGISTROACTIVIDAD] CHECK CONSTRAINT [FK_REGISTROACTIVIDAD_TIPOACTIVIDAD]
GO
ALTER TABLE [dbo].[SOLICITUD]  WITH CHECK ADD  CONSTRAINT [FK_SOLICITUD_EMPLEADO] FOREIGN KEY([SOLICITANTE_ID])
REFERENCES [dbo].[EMPLEADO] ([ID_EMPLEADO])
GO
ALTER TABLE [dbo].[SOLICITUD] CHECK CONSTRAINT [FK_SOLICITUD_EMPLEADO]
GO
ALTER TABLE [dbo].[SOLICITUD]  WITH CHECK ADD  CONSTRAINT [FK_SOLICITUD_TIPOSOLICITUD] FOREIGN KEY([TIPOSOLICITUD_ID])
REFERENCES [dbo].[TIPOSOLICITUD] ([ID_TIPOSOLICITUD])
GO
ALTER TABLE [dbo].[SOLICITUD] CHECK CONSTRAINT [FK_SOLICITUD_TIPOSOLICITUD]
GO
/****** Object:  StoredProcedure [dbo].[ActualizarDatosUsuario]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE   PROCEDURE [dbo].[ActualizarDatosUsuario]
@ID_EMPLEADO BIGINT,
@ID_TELEFONO1 BIGINT,
@TELEFONO1 NVARCHAR (22),
@ID_TELEFONO2 BIGINT,
@TELEFONO2 NVARCHAR (22),
@DIRRECCION NVARCHAR (600)
AS
BEGIN	
    -- Actualizar TELEFONO 1 si el ID y el tel�fono no son nulos
    IF @ID_TELEFONO1 IS NOT NULL AND @TELEFONO1 IS NOT NULL
    BEGIN
        UPDATE [dbo].[TELEFONO]
        SET [TELEFONO] = @TELEFONO1
        WHERE ID_TELEFONO = @ID_TELEFONO1
        AND EXISTS (
            SELECT 1
            FROM [dbo].[EMPLEADOTELEFONO] ET
            WHERE ET.EMPLEADO_ID = @ID_EMPLEADO
            AND ET.TELEFONO_ID = @ID_TELEFONO1
        );
    END;

    -- Actualizar TELEFONO 2 si el ID y el tel�fono no son nulos
    IF @ID_TELEFONO2 IS NOT NULL AND @TELEFONO2 IS NOT NULL
    BEGIN
        UPDATE [dbo].[TELEFONO]
        SET [TELEFONO] = @TELEFONO2
        WHERE ID_TELEFONO = @ID_TELEFONO2
        AND EXISTS (
            SELECT 1
            FROM [dbo].[EMPLEADOTELEFONO] ET
            WHERE ET.EMPLEADO_ID = @ID_EMPLEADO
            AND ET.TELEFONO_ID = @ID_TELEFONO2
        );
    END;

    -- Actualizar DIRECCION si @DIRRECCION no es nulo
    IF @DIRRECCION IS NOT NULL
    BEGIN
        UPDATE [dbo].[DIRRECCION]
        SET [DIRRECION] = COALESCE(@DIRRECCION, [DIRRECION])
        WHERE ID_DIRECCION IN (
            SELECT ED.DIRRECION_ID
            FROM [dbo].[EMPLEADODIRRECCION] ED
            WHERE ED.EMPLEADO_ID = @ID_EMPLEADO
        );
    END;
END
GO
/****** Object:  StoredProcedure [dbo].[AnnadirDireccion]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/23/2024
-- Description: A�ade nueva direccion a empleado.
-- =============================================
CREATE PROCEDURE [dbo].[AnnadirDireccion]
(
    -- Add the parameters for the stored procedure here
    @ID_EMPLEADO BIGINT,
    @NUEVA_DIRECCION VARCHAR(600)
)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here

        DECLARE @ID_DIRECCION BIGINT;

    BEGIN TRY
        BEGIN TRANSACTION;

        -- Insertar la nueva direcci�n en la tabla DIRRECCION
        INSERT INTO [dbo].[DIRRECCION] ([DIRRECION])
        VALUES (@NUEVA_DIRECCION);

        -- Obtener el ID de la direcci�n reci�n insertada
        SET @ID_DIRECCION = SCOPE_IDENTITY();

        -- Asociar la nueva direcci�n con el empleado en la tabla EMPLEADODIRRECCION
        INSERT INTO [dbo].[EMPLEADODIRRECCION] ([EMPLEADO_ID], [DIRRECION_ID])
        VALUES (@ID_EMPLEADO, @ID_DIRECCION);

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        -- Manejar el error
        DECLARE @ErrorMessage NVARCHAR(4000);
        DECLARE @ErrorSeverity INT;
        DECLARE @ErrorState INT;

        SELECT 
            @ErrorMessage = ERROR_MESSAGE(),
            @ErrorSeverity = ERROR_SEVERITY(),
            @ErrorState = ERROR_STATE();

        RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END
GO
/****** Object:  StoredProcedure [dbo].[AnnadirTelefono]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/23/2024
-- Description: A�ade nuevo telefono a empleado
-- =============================================
CREATE PROCEDURE [dbo].[AnnadirTelefono]
(
    -- Add the parameters for the stored procedure here
    @ID_EMPLEADO BIGINT,
    @NUEVO_TELEFONO VARCHAR(22)
)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here

        DECLARE @ID_TELEFONO BIGINT;

    BEGIN TRY
        BEGIN TRANSACTION;

        -- Insertar el nuevo tel�fono en la tabla TELEFONO
        INSERT INTO [dbo].[TELEFONO] ([TELEFONO])
        VALUES (@NUEVO_TELEFONO);

        -- Obtener el ID del tel�fono reci�n insertado
        SET @ID_TELEFONO = SCOPE_IDENTITY();

        -- Asociar el nuevo tel�fono con el empleado en la tabla EMPLEADOTELEFONO
        INSERT INTO [dbo].[EMPLEADOTELEFONO] ([EMPLEADO_ID], [TELEFONO_ID])
        VALUES (@ID_EMPLEADO, @ID_TELEFONO);

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        -- Manejar el error
        DECLARE @ErrorMessage NVARCHAR(4000);
        DECLARE @ErrorSeverity INT;
        DECLARE @ErrorState INT;

        SELECT 
            @ErrorMessage = ERROR_MESSAGE(),
            @ErrorSeverity = ERROR_SEVERITY(),
            @ErrorState = ERROR_STATE();

        RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END
GO
/****** Object:  StoredProcedure [dbo].[CambiarEstadoUsuarioAdmin]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      My Name
-- Create Date: 06/28/2024
-- Description: Cambia el estado de un empleado a su estado contrario).
-- =============================================
CREATE PROCEDURE [dbo].[CambiarEstadoUsuarioAdmin]
(
    -- Add the parameters for the stored procedure here
    @id_empleado bigint
)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

	Declare @estado_actual bit;

	SET @estado_actual = (SELECT ESTADO FROM EMPLEADO WHERE ID_EMPLEADO = @id_empleado);

    -- Insert statements for procedure here
	IF @estado_actual = 0
	BEGIN
		UPDATE EMPLEADO
		SET ESTADO = 1
		WHERE ID_EMPLEADO = @id_empleado;
	END
	ELSE
	BEGIN
		UPDATE EMPLEADO
		SET ESTADO = 0
		WHERE ID_EMPLEADO = @id_empleado;
	END
END
GO
/****** Object:  StoredProcedure [dbo].[ConsultarDatosEmpleado]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE   PROCEDURE [dbo].[ConsultarDatosEmpleado] 
@CORREO NVARCHAR(255)
AS
BEGIN
    DECLARE @NOMBREROL NVARCHAR(300);
    DECLARE @IDROL     INT;

    -- Obtener el rol del empleado
    SELECT @NOMBREROL = r.[Name], @IDROL = r.Id
    FROM [dbo].[AspNetUsers] u
    JOIN [dbo].[AspNetUserRoles] ur ON u.[Id] = ur.[UserId]
    JOIN [dbo].[AspNetRoles] r ON ur.[RoleId] = r.[Id]
    WHERE u.[Email] = @CORREO;

    -- Consultar los detalles del empleado
    SELECT e.ID_EMPLEADO , E.[IDENTIFICACION], E.[NOMBRECOMPLETO], E.[FECHA_INGRESO],
           E.[FOTO], E.[SALARIO], E.[SALDO_VACACIONES], CA.NOMBRE_CARGO AS CARGO, C.CORREO,
           E.[HORARIOLABORAL_ID], D.NOMBRE_DEPARTAMENTO AS DEPARTAMENTO, T.TELEFONO, DI.DIRRECION,
           @NOMBREROL AS NOMBREROL, @IDROL AS IDROL
    FROM [dbo].[EMPLEADO] E
    INNER JOIN CORREO C ON C.ID_CORREO = E.CORREO_ID
    INNER JOIN DEPARTAMENTO D ON E.DEPARTAMENTO_ID = D.ID_DEPARTAMENTO
    INNER JOIN CARGO CA ON E.CARGO_ID = CA.ID_CARGO
    INNER JOIN EMPLEADOTELEFONO ET ON ET.EMPLEADO_ID = E.ID_EMPLEADO
    INNER JOIN TELEFONO T ON T.ID_TELEFONO = ET.TELEFONO_ID
    INNER JOIN EMPLEADODIRRECCION ED ON ED.EMPLEADO_ID = E.ID_EMPLEADO
    INNER JOIN DIRRECCION DI ON DI.ID_DIRECCION = ED.DIRRECION_ID    
    WHERE C.CORREO = @CORREO;
END
GO
/****** Object:  StoredProcedure [dbo].[EditarDatosVistaAdmin]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/22/2024
-- Description: Modifica los datos desde la vista del administrador
-- =============================================
CREATE OR ALTER PROCEDURE [dbo].[EditarDatosVistaAdmin]
(
    -- Add the parameters for the stored procedure here
    @ID_EMPLEADO BIGINT,
    @IDENTIFICACION INT,
    @NOMBRECOMPLETO VARCHAR(250),
    @SALARIO DECIMAL(10, 2),
    @FOTO VARCHAR(250),
    @CORREO_ID NVARCHAR(255),
    @CARGO_ID BIGINT,
    @HORARIOLABORAL_ID BIGINT,
    @DEPARTAMENTO_ID BIGINT,
    @ROL_ID BIGINT,
    @ID_TELEFONO1 BIGINT,
    @TELEFONO1 NVARCHAR(22),
    @ID_TELEFONO2 BIGINT,
    @TELEFONO2 NVARCHAR(22),
    @DIRRECCION NVARCHAR(600)
)
AS
BEGIN 
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    DECLARE @AspNetUserID_ACTUAL NVARCHAR(450);
	DECLARE @CORREOID Bigint;
 
    SET @AspNetUserID_ACTUAL = (SELECT AspNetUsers_ID FROM EMPLEADO WHERE ID_EMPLEADO = @ID_EMPLEADO);

    IF EXISTS (SELECT 1 FROM [dbo].[EMPLEADO] WHERE [ID_EMPLEADO] = @ID_EMPLEADO)
    BEGIN


        UPDATE [dbo].[EMPLEADO]
        SET 
            [IDENTIFICACION] = COALESCE(@IDENTIFICACION, [IDENTIFICACION]),
            [NOMBRECOMPLETO] = COALESCE(@NOMBRECOMPLETO, [NOMBRECOMPLETO]),
            [SALARIO] = COALESCE(@SALARIO, [SALARIO]),
            [FOTO] = COALESCE(@FOTO, [FOTO]),
            [CORREO_ID] = COALESCE(@CORREO_ID, [CORREO_ID]),
            [CARGO_ID] = COALESCE(@CARGO_ID, [CARGO_ID]),
            [HORARIOLABORAL_ID] = COALESCE(@HORARIOLABORAL_ID, [HORARIOLABORAL_ID]),
            [DEPARTAMENTO_ID] = COALESCE(@DEPARTAMENTO_ID, [DEPARTAMENTO_ID])
        WHERE [ID_EMPLEADO] = @ID_EMPLEADO;
 
        IF @ID_TELEFONO1 IS NOT NULL AND @TELEFONO1 IS NOT NULL
        BEGIN
            UPDATE [dbo].[TELEFONO]
            SET [TELEFONO] = COALESCE(@TELEFONO1, [TELEFONO])
            WHERE ID_TELEFONO = @ID_TELEFONO1
            AND EXISTS (
                SELECT 1
                FROM [dbo].[EMPLEADOTELEFONO] ET
                WHERE ET.EMPLEADO_ID = @ID_EMPLEADO
                AND ET.TELEFONO_ID = @ID_TELEFONO1
            );
        END;
 
        IF @ID_TELEFONO2 IS NOT NULL AND @TELEFONO2 IS NOT NULL
        BEGIN
            UPDATE [dbo].[TELEFONO]
            SET [TELEFONO] = COALESCE(@TELEFONO2, [TELEFONO])
            WHERE ID_TELEFONO = @ID_TELEFONO2
            AND EXISTS (
                SELECT 1
                FROM [dbo].[EMPLEADOTELEFONO] ET
                WHERE ET.EMPLEADO_ID = @ID_EMPLEADO
                AND ET.TELEFONO_ID = @ID_TELEFONO2
            );
        END;
 
        IF @DIRRECCION IS NOT NULL
        BEGIN
            UPDATE [dbo].[DIRRECCION]
            SET [DIRRECION] = COALESCE(@DIRRECCION, [DIRRECION])
            WHERE ID_DIRECCION IN (
                SELECT ED.DIRRECION_ID
                FROM [dbo].[EMPLEADODIRRECCION] ED
                WHERE ED.EMPLEADO_ID = @ID_EMPLEADO
            );
        END;
 
        IF @ROL_ID IS NOT NULL
        BEGIN
            UPDATE [dbo].[AspNetUserRoles]
            SET [RoleId] = @ROL_ID
            WHERE UserId = @AspNetUserID_ACTUAL;
        END;
    END
    ELSE
    BEGIN
        RAISERROR ('El empleado con ID %d no existe.', 16, 1, @ID_EMPLEADO);
    END
 
end
/****** Object:  StoredProcedure [dbo].[ModificarDireccion]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/23/2024
-- Description: Modifica direccion
-- =============================================
CREATE PROCEDURE [dbo].[ModificarDireccion]
(
    -- Add the parameters for the stored procedure here
    @ID_DIRECCION BIGINT,
    @NUEVA_DIRECCION VARCHAR(600)
)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here

        -- Verificar si la direcci�n existe
    IF EXISTS (SELECT 1 FROM [dbo].[DIRRECCION] WHERE [ID_DIRECCION] = @ID_DIRECCION)
    BEGIN
        -- Actualizar la direcci�n
        UPDATE [dbo].[DIRRECCION]
        SET 
            [DIRRECION] = @NUEVA_DIRECCION
        WHERE 
            [ID_DIRECCION] = @ID_DIRECCION;
    END
    ELSE
    BEGIN
        -- Si la direcci�n no existe, lanzar un error
        RAISERROR ('La direcci�n con ID %d no existe.', 16, 1, @ID_DIRECCION);
    END
END
GO
/****** Object:  StoredProcedure [dbo].[ModificarTelefono]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/23/2024
-- Description: Modifica un telefono con el ID
-- =============================================
CREATE PROCEDURE [dbo].[ModificarTelefono]
(
    -- Add the parameters for the stored procedure here
    @ID_TELEFONO BIGINT,
    @NUEVO_TELEFONO VARCHAR(22)
)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here

        -- Verificar si el tel�fono existe
    IF EXISTS (SELECT 1 FROM [dbo].[TELEFONO] WHERE [ID_TELEFONO] = @ID_TELEFONO)
    BEGIN
        -- Actualizar el tel�fono
        UPDATE [dbo].[TELEFONO]
        SET 
            [TELEFONO] = @NUEVO_TELEFONO
        WHERE 
            [ID_TELEFONO] = @ID_TELEFONO;
    END
    ELSE
    BEGIN
        -- Si el tel�fono no existe, lanzar un error
        RAISERROR ('El tel�fono con ID %d no existe.', 16, 1, @ID_TELEFONO);
    END
END
GO

/****** Object:  StoredProcedure [dbo].[MostrarEmpleadoVistaAdmin]    Script Date: 6/30/2024 10:22:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      WilsonArias
-- Create Date: 06/22/2024
-- Description: Muestra los datos de empleado especifico usando el ID para un administrador
-- =============================================
CREATE OR ALTER PROCEDURE [dbo].[MostrarEmpleadoVistaAdmin]
(
    @ID_EMPLEADO bigint
)
AS
BEGIN
    SET NOCOUNT ON;

    SELECT 
        e.IDENTIFICACION,
        e.ID_EMPLEADO,
        e.NOMBRECOMPLETO,
        e.SALARIO,
        e.FOTO,
        c.CORREO,
        ca.NOMBRE_CARGO AS CARGO,
		ca.ID_CARGO,
        hl.DESCRIPCION AS NOMBRE_HL,
		hl.ID_HORARIOLABORAL,
        d.NOMBRE_DEPARTAMENTO AS DEPARTAMENTO,
		d.ID_DEPARTAMENTO,
        -- Concatenar direcciones
        (SELECT dir.DIRRECION
         FROM EMPLEADODIRRECCION ed
         INNER JOIN DIRRECCION dir ON ed.DIRRECION_ID = dir.ID_DIRECCION
         WHERE ed.EMPLEADO_ID = e.ID_EMPLEADO) AS DIRRECION,
        
        CASE WHEN e.ESTADO = 1 THEN 'Activo' ELSE 'Inactivo' END AS ESTADO,
        -- Obtener el rol del usuario
        (SELECT r.Name
         FROM AspNetUserRoles ur
         INNER JOIN AspNetRoles r ON ur.RoleId = r.Id
         WHERE ur.UserId = e.AspNetUsers_ID) AS NOMBREROL
		 
    FROM EMPLEADO e
    LEFT JOIN CORREO c ON e.CORREO_ID = c.ID_CORREO
    LEFT JOIN CARGO ca ON e.CARGO_ID = ca.ID_CARGO
    LEFT JOIN HORARIOLABORAL hl ON e.HORARIOLABORAL_ID = hl.ID_HORARIOLABORAL
    LEFT JOIN DEPARTAMENTO d ON e.DEPARTAMENTO_ID = d.ID_DEPARTAMENTO
    WHERE e.ID_EMPLEADO = @ID_EMPLEADO;
END
GO

/****** Object:  StoredProcedure [dbo].[MostrarInfoVistaAdmin]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/22/2024
-- Description: Muestra todos los empleados para un administrador
-- =============================================
CREATE PROCEDURE [dbo].[MostrarInfoVistaAdmin]

    -- Add the parameters for the stored procedure here

AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here
    SELECT 
        e.ID_EMPLEADO,
        e.NOMBRECOMPLETO,
		        -- Obtener el rol del usuario
        (SELECT STRING_AGG(r.Name, ', ')
         FROM AspNetUserRoles ur
         INNER JOIN AspNetRoles r ON ur.RoleId = r.Id
         WHERE ur.UserId = e.AspNetUsers_ID) AS NOMBREROL,
		 d.NOMBRE_DEPARTAMENTO AS DEPARTAMENTO,
         ca.NOMBRE_CARGO AS CARGO,
		CASE WHEN e.ESTADO = 1 THEN 'Activo' ELSE 'Inactivo' END AS ESTADO
    FROM EMPLEADO e
    LEFT JOIN CARGO ca ON e.CARGO_ID = ca.ID_CARGO
    LEFT JOIN DEPARTAMENTO d ON e.DEPARTAMENTO_ID = d.ID_DEPARTAMENTO
END
GO
/****** Object:  StoredProcedure [dbo].[MostrarTodosCargos]    Script Date: 6/30/2024 10:42:23 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/28/2024
-- Description: Muestra todos los cargos del sistema.
-- =============================================
CREATE PROCEDURE [dbo].[MostrarTodosCargos]

    -- Add the parameters for the stored procedure here

AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here
    SELECT ID_CARGO, NOMBRE_CARGO AS CARGO
       FROM CARGO;
END
GO
/****** Object:  StoredProcedure [dbo].[MostrarTodosDepartamentos]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/28/2024
-- Description: Muestra todos los departamentos en el sistema.
-- =============================================
CREATE PROCEDURE [dbo].[MostrarTodosDepartamentos]

    -- Add the parameters for the stored procedure here

AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here
    SELECT ID_DEPARTAMENTO, NOMBRE_DEPARTAMENTO AS DEPARTAMENTO
       FROM DEPARTAMENTO;
END
GO
/****** Object:  StoredProcedure [dbo].[MostrarTodosHorarios]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/28/2024
-- Description: Muestra todos los horarios disponibles en el sistema.
-- =============================================
CREATE PROCEDURE [dbo].[MostrarTodosHorarios]

    -- Add the parameters for the stored procedure here

AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here
    SELECT ID_HORARIOLABORAL,
            CONCAT(NOMBREHL, ' - ', CONVERT(varchar(5), HORA_INGRESO, 108), ' hasta ', CONVERT(varchar(5), HORA_SALIDA, 108)) AS NOMBRE_HL
       FROM HORARIOLABORAL;
END
GO
/****** Object:  StoredProcedure [dbo].[MostrarTodosRoles]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/28/2024
-- Description: Muestra todos los roles disponibles.
-- =============================================
CREATE PROCEDURE [dbo].[MostrarTodosRoles]

    -- Add the parameters for the stored procedure here

AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here
    SELECT Id AS IDROL, Name AS NOMBREROL
       FROM AspNetRoles;
END
GO
/****** Object:  StoredProcedure [dbo].[NotificacionSolicitud]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[NotificacionSolicitud] 

@id_solicitud VARCHAR(50)
AS
BEGIN TRY
	SET NOCOUNT ON;	

	DECLARE	@Titule NVARCHAR(MAX),
			@Head NVARCHAR(MAX),
		    @Body NVARCHAR(MAX),
	        @MENSAJE_SOLICITUD NVARCHAR(MAX),
			@tipo_solicitud  VARCHAR(MAX),
			@Email_Usuario VARCHAR(MAX),
			@Descripcion_movimiento VARCHAR(MAX),
			@id_tipo_solicitud VARCHAR(MAX),
			@fecha_solicitud VARCHAR(MAX),
			@responsable_solicitud VARCHAR(MAX),
			@comentario_movimiento VARCHAR(MAX),
			@usuario_creador_solicitud VARCHAR(MAX),
			@Email_Usuario_aprobar VARCHAR(MAX),
			@id_responsable_solicitud VARCHAR(MAX),
			@horario_actual VARCHAR(MAX),
			@horario_nuevo VARCHAR(MAX),
			@footer VARCHAR(MAX)		

	DECLARE @Resultado INT,
			
			@TablePermiso   nvarchar(max),
			@TableAprobacion nvarchar(max),
		    @EncabezadoAprobacion  nvarchar(max),
			@INICIO_CORREO NVARCHAR(MAX),
		    @Encabezado_Correo NVARCHAR(MAX),
			@Alerta_Solicitud NVARCHAR(MAX),
			@Alerta_Aprobacion NVARCHAR(MAX),
			@MENSAJE_APROBACION  NVARCHAR(MAX),
			@APROBACION  NVARCHAR(MAX)
			
	
	

	SET @tipo_solicitud = (select tipo.NOMBRE_TIPO_SOLICITUD  from SOLICITUD soli
  inner join TIPOSOLICITUD tipo
  on soli.TIPOSOLICITUD_ID=tipo.ID_TIPOSOLICITUD
  where soli.ID_SOLICITUD=@id_solicitud)
  SET @id_tipo_solicitud = (select tipo.ID_TIPOSOLICITUD  from SOLICITUD soli
  inner join TIPOSOLICITUD tipo
  on soli.TIPOSOLICITUD_ID=tipo.ID_TIPOSOLICITUD
  where soli.ID_SOLICITUD=@id_solicitud)
	
	
	SET @fecha_solicitud = ( select  FECHA_SOLICITUD from SOLICITUD
   where ID_SOLICITUD= @id_solicitud )
	
    SET @Email_Usuario = ( select co.CORREO from SOLICITUD soli
   inner join empleado emple on emple.ID_EMPLEADO=soli.SOLICITANTE_ID
   inner join CORREO  co on co.ID_CORREO=emple.CORREO_ID
   where soli.ID_SOLICITUD=@id_solicitud)
	SET @responsable_solicitud = ( select emple.NOMBRECOMPLETO from SOLICITUD soli
   inner join empleado emple on emple.ID_EMPLEADO=soli.SOLICITANTE_ID
   where soli.ID_SOLICITUD=@id_solicitud)

   SET @id_responsable_solicitud = ( select emple.ID_EMPLEADO from SOLICITUD soli
   inner join empleado emple on emple.ID_EMPLEADO=soli.SOLICITANTE_ID
   where soli.ID_SOLICITUD=@id_solicitud)

   set @Email_Usuario_aprobar=(select  co.CORREO from APROBACIONSOLICITUD apsoli

inner join EMPLEADO emple on apsoli.ENCARGADO_APROBACION_ID=emple.ID_EMPLEADO
inner join CORREO co on co.ID_CORREO=emple.CORREO_ID

where apsoli.SOLICITUD_ID=@id_solicitud and apsoli.SECUENCIA=1)

SET @horario_actual= (select hl.NOMBREHL from EMPLEADO empl
inner join HORARIOLABORAL hl on empl.HORARIOLABORAL_ID=hl.ID_HORARIOLABORAL
where empl.ID_EMPLEADO=@id_responsable_solicitud)

SET @horario_nuevo= (select hl.NOMBREHL from SOLICITUD soli
inner join HORARIOLABORAL hl on soli.ID_HORARIOLABORAL=hl.ID_HORARIOLABORAL
where soli.ID_SOLICITUD=@id_solicitud)


---TIPO DE PERMISO VACACIONES/INCAPACIDADES/PERMISOS ESPECIALES)

if(@id_tipo_solicitud=1 or @id_tipo_solicitud=2 or @id_tipo_solicitud=3)
begin
SET @INICIO_CORREO = 
		'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
		<html xmlns="http://www.w3.org/1999/xhtml" xmlns:o="urn:schemas-microsoft-com:office:office" style="width:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;padding:0;Margin:0">

		<head>
			<meta charset="UTF-8">
			<meta content="width=device-width, initial-scale=1" name="viewport">
			<meta name="x-apple-disable-message-reformatting">
			<meta http-equiv="X-UA-Compatible" content="IE=edge">
			<meta content="telephone=no" name="format-detection">
			<title>AMS</title>

			<style type="text/css">
				#outlook a {
					padding: 0;
				}
        
				.ExternalClass {
					width: 100%;
				}
        
				.ExternalClass,
				.ExternalClass p,
				.ExternalClass span,
				.ExternalClass font,
				.ExternalClass td,
				.ExternalClass div {
					line-height: 100%;
				}
        
				.es-button {
					mso-style-priority: 100!important;
					text-decoration: none!important;
				}
        
				a[x-apple-data-detectors] {
					color: inherit!important;
					text-decoration: none!important;
					font-size: inherit!important;
					font-family: inherit!important;
					font-weight: inherit!important;
					line-height: inherit!important;
				}
        
				.es-desk-hidden {
					display: none;
					float: left;
					overflow: hidden;
					width: 0;
					max-height: 0;
					line-height: 0;
					mso-hide: all;
				}
        
				[data-ogsb] .es-button {
					border-width: 0!important;
					padding: 10px 20px 10px 20px!important;
				}
        
				@media only screen and (max-width:600px) {
					p,
					ul li,
					ol li,
					a {
						line-height: 150%!important
					}
					h1,
					h2,
					h3,
					h1 a,
					h2 a,
					h3 a {
						line-height: 120%!important
					}
					h1 {
						font-size: 30px!important;
						text-align: center
					}
					h2 {
						font-size: 26px!important;
						text-align: center
					}
					h3 {
						font-size: 20px!important;
						text-align: center
					}
					.es-header-body h1 a,
					.es-content-body h1 a,
					.es-footer-body h1 a {
						font-size: 30px!important
					}
					.es-header-body h2 a,
					.es-content-body h2 a,
					.es-footer-body h2 a {
						font-size: 26px!important
					}
					.es-header-body h3 a,
					.es-content-body h3 a,
					.es-footer-body h3 a {
						font-size: 20px!important
					}
					.es-menu td a {
						font-size: 16px!important
					}
					.es-header-body p,
					.es-header-body ul li,
					.es-header-body ol li,
					.es-header-body a {
						font-size: 16px!important
					}
					.es-content-body p,
					.es-content-body ul li,
					.es-content-body ol li,
					.es-content-body a {
						font-size: 16px!important
					}
					.es-footer-body p,
					.es-footer-body ul li,
					.es-footer-body ol li,
					.es-footer-body a {
						font-size: 16px!important
					}
					.es-infoblock p,
					.es-infoblock ul li,
					.es-infoblock ol li,
					.es-infoblock a {
						font-size: 12px!important
					}
					*[class="gmail-fix"] {
						display: none!important
					}
					.es-m-txt-c,
					.es-m-txt-c h1,
					.es-m-txt-c h2,
					.es-m-txt-c h3 {
						text-align: center!important
					}
					.es-m-txt-r,
					.es-m-txt-r h1,
					.es-m-txt-r h2,
					.es-m-txt-r h3 {
						text-align: right!important
					}
					.es-m-txt-l,
					.es-m-txt-l h1,
					.es-m-txt-l h2,
					.es-m-txt-l h3 {
						text-align: left!important
					}
					.es-m-txt-r img,
					.es-m-txt-c img,
					.es-m-txt-l img {
						display: inline!important
					}
					.es-button-border {
						display: block!important
					}
					a.es-button,
					button.es-button {
						font-size: 20px!important;
						display: block!important;
						border-width: 10px 0px 10px 0px!important
					}
					.es-btn-fw {
						border-width: 10px 0px!important;
						text-align: center!important
					}
					.es-adaptive table,
					.es-btn-fw,
					.es-btn-fw-brdr,
					.es-left,
					.es-right {
						width: 100%!important
					}
					.es-content table,
					.es-header table,
					.es-footer table,
					.es-content,
					.es-footer,
					.es-header {
						width: 100%!important;
						max-width: 600px!important
					}
					.es-adapt-td {
						display: block!important;
						width: 100%!important
					}
					.adapt-img {
						width: 100%!important;
						height: auto!important
					}
					.es-m-p0 {
						padding: 0px!important
					}
					.es-m-p0r {
						padding-right: 0px!important
					}
					.es-m-p0l {
						padding-left: 0px!important
					}
					.es-m-p0t {
						padding-top: 0px!important
					}
					.es-m-p0b {
						padding-bottom: 0!important
					}
					.es-m-p20b {
						padding-bottom: 20px!important
					}
					.es-mobile-hidden,
					.es-hidden {
						display: none!important
					}
					tr.es-desk-hidden,
					td.es-desk-hidden,
					table.es-desk-hidden {
						width: auto!important;
						overflow: visible!important;
						float: none!important;
						max-height: inherit!important;
						line-height: inherit!important
					}
					tr.es-desk-hidden {
						display: table-row!important
					}
					table.es-desk-hidden {
						display: table!important
					}
					td.es-desk-menu-hidden {
						display: table-cell!important
					}
					.es-menu td {
						width: 1%!important
					}
					table.es-table-not-adapt,
					.esd-block-html table {
						width: auto!important
					}
					table.es-social {
						display: inline-block!important
					}
					table.es-social td {
						display: inline-block!important
					}
					.es-desk-hidden {
						display: table-row!important;
						width: auto!important;
						overflow: visible!important;
						max-height: inherit!important
					}
					.h-auto {
						height: auto!important
					}
				}
			</style>
		</head>

		<body style="width:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;font-family:arial, ''helvetica neue'', helvetica, sans-serif;padding:0;Margin:0">
			<div class="es-wrapper-color" style="background-color:#E4E5E7">
				<table class="es-wrapper" width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;padding:0;Margin:0;width:100%;height:100%;background-repeat:repeat;background-position:center top;background-color:#E4E5E7">
					<tr style="border-collapse:collapse">
						<td valign="top" style="padding:0;Margin:0">
							<table class="es-header" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%;background-color:transparent;background-repeat:repeat;background-position:center top">
								<tr style="border-collapse:collapse">
									<td align="center" style="padding:0;Margin:0">
										<table class="es-header-body" cellspacing="0" cellpadding="0" align="center" bgcolor="#094293" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#094293;width:600px">
											<tr style="border-collapse:collapse">
												<td align="left" style="padding:0;Margin:0;padding-top:20px;padding-left:20px;padding-right:20px">
													<table class="es-left" cellspacing="0" cellpadding="0" align="left" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;float:left">
														<tr style="border-collapse:collapse">
															<td class="es-m-p0r es-m-p20b" valign="top" align="center" style="padding:0;Margin:0;width:178px">
																
															</td>
														</tr>
													</table>
													<table cellspacing="0" cellpadding="0" align="right" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
														<tr style="border-collapse:collapse">
															<td align="left" style="padding:0;Margin:0;width:362px">
																<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
																	<tr style="border-collapse:collapse">
																		<td class="es-m-txt-c" align="right" style="padding:0;Margin:0;padding-top:15px;padding-bottom:20px">
																			<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#FFFFFF;font-size:14px">'+@fecha_solicitud+'</p>
																		</td>
																	</tr>
																</table>
															</td>
														</tr>
													</table>
												</td>
											</tr>
											<tr style="border-collapse:collapse">
												<td align="left" style="padding:0;Margin:0">
													<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
														<tr style="border-collapse:collapse">
															<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
																
															</td>
														</tr>
													</table>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>'

	SET @Alerta_Solicitud = 
		'<table class="es-content" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%">
			<tr style="border-collapse:collapse">
				<td align="center" style="padding:0;Margin:0">
					<table class="es-content-body" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#ededed;width:600px" cellspacing="0" cellpadding="0" bgcolor="#ededed" align="center">
						<tr style="border-collapse:collapse">
							<td align="left" style="padding:0;Margin:0">
								<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
									<tr style="border-collapse:collapse">
										<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
											<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
												<tr style="border-collapse:collapse">
													<td align="center" style="padding:0;Margin:0;padding-top:20px;padding-left:40px;padding-right:40px">
														<h1 style="Margin:0;line-height:31px;mso-line-height-rule:exactly;font-family:tahoma, verdana, segoe, sans-serif;font-size:26px;font-style:normal;font-weight:normal;color:#333333">Detalles Solicitud</h1>
														<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><br></p>
													</td>
												</tr>
												
												
												
											</table>
										</td>
									</tr>
								</table>
							</td>
						</tr>
						<tr style="border-collapse:collapse">
							<td align="left" style="padding:0;Margin:0">
								<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
									<tr style="border-collapse:collapse">
										<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
											
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>'

	SET @Encabezado_Correo = 
				'<table class="es-content" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%">
					<tr style="border-collapse:collapse">
						<td align="center" style="padding:0;Margin:0">
							<table class="es-content-body" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#ffffff;width:600px" cellspacing="0" cellpadding="0" bgcolor="#ffffff" align="center">
								<tr style="border-collapse:collapse">
									<td align="left" style="padding:0;Margin:0;padding-top:15px;padding-left:20px;padding-right:20px">
										<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
											<tr style="border-collapse:collapse">
												<td valign="top" align="center" style="padding:0;Margin:0;width:560px">
													
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<tr style="border-collapse:collapse">
									<td align="left" style="Margin:0;padding-top:20px;padding-left:20px;padding-right:20px;padding-bottom:25px">
										<table cellspacing="0" cellpadding="0" width="100%" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
											<tr style="border-collapse:collapse">
												<td align="left" style="padding:0;Margin:0;width:560px">
													<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
														
														<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>N�mero de solicitud: </strong> '+ @id_solicitud +'</p>
															</td>
														</tr>
														<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>Fecha solicitud : </strong> '+ @fecha_solicitud +'</p>
															</td>
														</tr>
														<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>Responsable de la solicitud: </strong> '+@responsable_solicitud+'</p>
															</td>
														</tr>

														<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>Tipo de Permiso: </strong> '+@tipo_solicitud+'</p>
															</td>
														</tr>

													</table>
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<tr style="border-collapse:collapse">
									<td style="padding:0;Margin:0;background-color:#ededed" bgcolor="#ededed" align="left">
										<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
											<tr style="border-collapse:collapse">
												<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
													
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
				<table class="es-content" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%">
					<tr style="border-collapse:collapse">
						<td align="center" style="padding:0;Margin:0">
							<table class="es-content-body" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#ededed;width:600px" cellspacing="0" cellpadding="0" bgcolor="#ededed" align="center">
								<tr style="border-collapse:collapse">
									<td align="left" style="Margin:0;padding-top:20px;padding-bottom:20px;padding-left:40px;padding-right:40px">
										<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
											<tr style="border-collapse:collapse">
												<td align="left" style="padding:0;Margin:0;width:520px">
													<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
														<tr style="border-collapse:collapse">
															<td class="h-auto" align="center" height="30" style="padding:0;Margin:0">
																<h3 style="Margin:0;line-height:24px;mso-line-height-rule:exactly;font-family:tahoma, verdana, segoe, sans-serif;font-size:20px;font-style:normal;font-weight:normal;color:#333333">Datos del Permiso:</h3>
															</td>
														</tr>
														<tr style="border-collapse:collapse">
															<td style="padding:0;Margin:0">
																<table style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
																	<tr style="border-collapse:collapse">
																		<th></th>
																	</tr>
																</table>
															</td>
														</tr>
														<tr style="border-collapse:collapse">
															<td align="center" style="padding:0;Margin:0;padding-top:10px;padding-bottom:10px">
																<table border="1" align="center" cellspacing="1" cellpadding="3" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;height:70px;width:500px" class="es-table">
																	<thead>
																		<tr style="border-collapse:collapse">
																			<th style="font-size:12px;text-align:center" scope="col">Permiso</th>
																			<th style="font-size:12px;text-align:center" scope="col">Fecha Inicio</th>
					  													    <th style="font-size:12px;text-align:center" scope="col">Fecha Final</th>
																			<th style="font-size:12px;text-align:center" scope="col">Dias</th>
																			<th style="font-size:12px;text-align:center" scope="col">Tipo Permiso</th>
																			<th style="font-size:12px;text-align:center" scope="col">Comentario</th>
																			<th style="font-size:12px;text-align:center" scope="col">Detalle</th>
																		</tr>
																	</thead>
																	<tr style="border-collapse:collapse">' 
	
	

	

	SET @TablePermiso = 
	(	select soli.ID_SOLICITUD AS [TD]	,  CONVERT(VARCHAR, soli.FECHA_INICIO, 103) AS [TD]	, convert (VARCHAR,  soli.FECHA_FINAL, 103) AS [TD]	,
   soli.DIAS AS [TD]	 ,  tipo.NOMBRE_TIPO_SOLICITUD AS [TD]	 , soli.COMENTARIO AS [TD]	, soli.DETALLE as [TD] from SOLICITUD soli
  inner join TIPOSOLICITUD tipo
  on tipo.ID_TIPOSOLICITUD=soli.TIPOSOLICITUD_ID
  where soli.ID_SOLICITUD=@id_solicitud
		FOR XML RAW('tr'), ELEMENTS) + ' 
														</tr>
													</table>
												</td>
											</tr>
											<tr style="border-collapse:collapse">
												<td class="h-auto" align="center" height="30" style="padding:0;Margin:0">
													<h3 style="Margin:0;line-height:24px;mso-line-height-rule:exactly;font-family:tahoma, verdana, segoe, sans-serif;font-size:20px;font-style:normal;font-weight:normal;color:#333333"><br></h3>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>' 

	
											
	SET @EncabezadoAprobacion = 
	'<table class="es-content" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%">
		<tr style="border-collapse:collapse">
			<td align="center" style="padding:0;Margin:0">
				<table class="es-content-body" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#ededed;width:600px" cellspacing="0" cellpadding="0" bgcolor="#ededed" align="center">
					<tr style="border-collapse:collapse">
						<td align="left" style="Margin:0;padding-top:20px;padding-bottom:20px;padding-left:40px;padding-right:40px">
							<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
								<tr style="border-collapse:collapse">
									<td align="left" style="padding:0;Margin:0;width:520px">
										<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
											<tr style="border-collapse:collapse">
												<td class="h-auto" align="center" height="30" style="padding:0;Margin:0">
													<h3 style="Margin:0;line-height:24px;mso-line-height-rule:exactly;font-family:tahoma, verdana, segoe, sans-serif;font-size:20px;font-style:normal;font-weight:normal;color:#333333">Aprobaciones:</h3>
												</td>
											</tr>
											<tr style="border-collapse:collapse">
												<td style="padding:0;Margin:0">
													<table style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
														<tr style="border-collapse:collapse">
															<th></th>
														</tr>
													</table>
												</td>
											</tr>
											<tr style="border-collapse:collapse">
												<td align="center" style="padding:0;Margin:0;padding-top:10px;padding-bottom:10px">
													<table border="1" align="center" cellspacing="1" cellpadding="3" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;height:70px;width:500px" class="es-table">
														<thead>
															<tr style="border-collapse:collapse">
																<th style="font-size:12px;text-align:center;color:#000000" scope="col">Departamento</th>
																<th style="font-size:12px;text-align:center;color:#000000" scope="col">Encargado</th>
																<th style="font-size:12px;text-align:center;color:#000000" scope="col">Secuencia</th>
																<th style="font-size:12px;text-align:center;color:#000000" scope="col">Estado</th>
															</tr>
														</thead>
														<tr style="border-collapse:collapse">'

	SET @TableAprobacion = 
		(SELECT DEPAP.DESCRIPCION AS [TD] ,EMPLE.NOMBRECOMPLETO AS [TD], APSOLI.SECUENCIA AS [TD],   CASE APSOLI.RESPUESTA_SOLICITUD
When 'P' Then 'PENDIENTE'
When 'A' Then 'APROBADO'
ELSE 'RECHAZADO' 
END  AS [TD] FROM APROBACIONSOLICITUD APSOLI
INNER JOIN EMPLEADO EMPLE ON APSOLI.ENCARGADO_APROBACION_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTOSUPERVISOR DEPASUP ON DEPASUP.EMPLEADO_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTO DEPAP ON DEPAP.ID_DEPARTAMENTO=DEPASUP.DEPARTAMENTO_ID

WHERE APSOLI.SOLICITUD_ID=@id_solicitud		

order by APSOLI.SECUENCIA ASC
		FOR XML RAW('tr'), ELEMENTS) + '
														</tr>
													</table>
												</td>
											</tr>
											<tr style="border-collapse:collapse">
												<td class="h-auto" align="center" height="30" style="padding:0;Margin:0">
													<h3 style="Margin:0;line-height:24px;mso-line-height-rule:exactly;font-family:tahoma, verdana, segoe, sans-serif;font-size:20px;font-style:normal;font-weight:normal;color:#333333"><br></h3>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>'


	SET @APROBACION = '
						<tr>
                          <td>
                            <table cellpadding="0" cellspacing="0" width="100%" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
                              <tr>
                                <td align="center" valign="top" style="padding:0;Margin:0;width:560px">
                                  <table cellpadding="0" cellspacing="0" width="100%" role="presentation" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
                                    <tr>
                                      <td align="center" style="padding:0;Margin:0;padding-top:15px;padding-bottom:15px">
                                        <span class="es-button-border" style="border-style:solid;color:#FFFFFF;border-color:#094293;background:#094293;border-width:4px;display:inline-block;border-radius:10px;width:auto">
										  
                                            Ingrese al m�dulo Gesti�n de Personal a consultar los detalles del registro del permiso
											
									    </span>
									  </td>
                                    </tr>
                                  </table>
                                </td>
                              </tr>
                            </table>
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
					'

	SET @footer = 
		'<table class="es-content" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%">
			<tr style="border-collapse:collapse">
				<td align="center" style="padding:0;Margin:0">
					<table class="es-content-body" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#ededed;width:600px" cellspacing="0" cellpadding="0" bgcolor="#ededed" align="center">
						<tr style="border-collapse:collapse">
							<td align="left" style="padding:0;Margin:0">
								<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
									<tr style="border-collapse:collapse">
										<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
											
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
		<table cellpadding="0" cellspacing="0" class="es-footer" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%;background-color:transparent;background-repeat:repeat;background-position:center top">
			<tr style="border-collapse:collapse">
				<td align="center" style="padding:0;Margin:0">
					<table class="es-footer-body" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:transparent;width:600px">
						<tr style="border-collapse:collapse">
							<td align="left" bgcolor="#094293" style="padding:0;Margin:0;padding-top:20px;padding-left:20px;padding-right:20px;background-color:#094293">
								<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
									<tr style="border-collapse:collapse">
										<td valign="top" align="center" style="padding:0;Margin:0;width:560px">
											<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
												<tr style="border-collapse:collapse">
												</tr>
											</table>
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
						</td>
					</tr>
				</table>
			</div>
		</body>
	</html> '


	
		SET  @MENSAJE_SOLICITUD =	@INICIO_CORREO			+ @Alerta_Solicitud			+ @Encabezado_Correo	+
								   @TablePermiso 	+  @EncabezadoAprobacion	+ @TableAprobacion		+ @footer
	
	    SET  @MENSAJE_APROBACION=	@INICIO_CORREO			+ @Alerta_Solicitud			+ @Encabezado_Correo	+
								   @TablePermiso 	+  @EncabezadoAprobacion	+ @TableAprobacion		+@APROBACION+ @footer
 
	
		IF @Email_Usuario <> ''
			BEGIN
				EXEC msdb.dbo.sp_send_dbmail
					@profile_name = 'EnvioMail',
					@recipients =  @Email_Usuario,
					@subject = 'NOTIFICACION-REGISTRO DE PERMISO',
					@body =  @MENSAJE_SOLICITUD,
					@body_format = 'HTML';
			END

			IF @Email_Usuario <> ''
			BEGIN
				EXEC msdb.dbo.sp_send_dbmail
					@profile_name = 'EnvioMail',
					@recipients =  @Email_Usuario_aprobar,
					@subject = 'REGISTRO DE PERMISO PARA APROBACION',
					@body =  @MENSAJE_APROBACION,
					@body_format = 'HTML';
			END

	select @responsable_solicitud
	select @MENSAJE_SOLICITUD
	select @Email_Usuario

    SET @Resultado = 1

end
else

begin

SET @INICIO_CORREO = 
		'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
		<html xmlns="http://www.w3.org/1999/xhtml" xmlns:o="urn:schemas-microsoft-com:office:office" style="width:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;padding:0;Margin:0">

		<head>
			<meta charset="UTF-8">
			<meta content="width=device-width, initial-scale=1" name="viewport">
			<meta name="x-apple-disable-message-reformatting">
			<meta http-equiv="X-UA-Compatible" content="IE=edge">
			<meta content="telephone=no" name="format-detection">
			<title>AMS</title>

			<style type="text/css">
				#outlook a {
					padding: 0;
				}
        
				.ExternalClass {
					width: 100%;
				}
        
				.ExternalClass,
				.ExternalClass p,
				.ExternalClass span,
				.ExternalClass font,
				.ExternalClass td,
				.ExternalClass div {
					line-height: 100%;
				}
        
				.es-button {
					mso-style-priority: 100!important;
					text-decoration: none!important;
				}
        
				a[x-apple-data-detectors] {
					color: inherit!important;
					text-decoration: none!important;
					font-size: inherit!important;
					font-family: inherit!important;
					font-weight: inherit!important;
					line-height: inherit!important;
				}
        
				.es-desk-hidden {
					display: none;
					float: left;
					overflow: hidden;
					width: 0;
					max-height: 0;
					line-height: 0;
					mso-hide: all;
				}
        
				[data-ogsb] .es-button {
					border-width: 0!important;
					padding: 10px 20px 10px 20px!important;
				}
        
				@media only screen and (max-width:600px) {
					p,
					ul li,
					ol li,
					a {
						line-height: 150%!important
					}
					h1,
					h2,
					h3,
					h1 a,
					h2 a,
					h3 a {
						line-height: 120%!important
					}
					h1 {
						font-size: 30px!important;
						text-align: center
					}
					h2 {
						font-size: 26px!important;
						text-align: center
					}
					h3 {
						font-size: 20px!important;
						text-align: center
					}
					.es-header-body h1 a,
					.es-content-body h1 a,
					.es-footer-body h1 a {
						font-size: 30px!important
					}
					.es-header-body h2 a,
					.es-content-body h2 a,
					.es-footer-body h2 a {
						font-size: 26px!important
					}
					.es-header-body h3 a,
					.es-content-body h3 a,
					.es-footer-body h3 a {
						font-size: 20px!important
					}
					.es-menu td a {
						font-size: 16px!important
					}
					.es-header-body p,
					.es-header-body ul li,
					.es-header-body ol li,
					.es-header-body a {
						font-size: 16px!important
					}
					.es-content-body p,
					.es-content-body ul li,
					.es-content-body ol li,
					.es-content-body a {
						font-size: 16px!important
					}
					.es-footer-body p,
					.es-footer-body ul li,
					.es-footer-body ol li,
					.es-footer-body a {
						font-size: 16px!important
					}
					.es-infoblock p,
					.es-infoblock ul li,
					.es-infoblock ol li,
					.es-infoblock a {
						font-size: 12px!important
					}
					*[class="gmail-fix"] {
						display: none!important
					}
					.es-m-txt-c,
					.es-m-txt-c h1,
					.es-m-txt-c h2,
					.es-m-txt-c h3 {
						text-align: center!important
					}
					.es-m-txt-r,
					.es-m-txt-r h1,
					.es-m-txt-r h2,
					.es-m-txt-r h3 {
						text-align: right!important
					}
					.es-m-txt-l,
					.es-m-txt-l h1,
					.es-m-txt-l h2,
					.es-m-txt-l h3 {
						text-align: left!important
					}
					.es-m-txt-r img,
					.es-m-txt-c img,
					.es-m-txt-l img {
						display: inline!important
					}
					.es-button-border {
						display: block!important
					}
					a.es-button,
					button.es-button {
						font-size: 20px!important;
						display: block!important;
						border-width: 10px 0px 10px 0px!important
					}
					.es-btn-fw {
						border-width: 10px 0px!important;
						text-align: center!important
					}
					.es-adaptive table,
					.es-btn-fw,
					.es-btn-fw-brdr,
					.es-left,
					.es-right {
						width: 100%!important
					}
					.es-content table,
					.es-header table,
					.es-footer table,
					.es-content,
					.es-footer,
					.es-header {
						width: 100%!important;
						max-width: 600px!important
					}
					.es-adapt-td {
						display: block!important;
						width: 100%!important
					}
					.adapt-img {
						width: 100%!important;
						height: auto!important
					}
					.es-m-p0 {
						padding: 0px!important
					}
					.es-m-p0r {
						padding-right: 0px!important
					}
					.es-m-p0l {
						padding-left: 0px!important
					}
					.es-m-p0t {
						padding-top: 0px!important
					}
					.es-m-p0b {
						padding-bottom: 0!important
					}
					.es-m-p20b {
						padding-bottom: 20px!important
					}
					.es-mobile-hidden,
					.es-hidden {
						display: none!important
					}
					tr.es-desk-hidden,
					td.es-desk-hidden,
					table.es-desk-hidden {
						width: auto!important;
						overflow: visible!important;
						float: none!important;
						max-height: inherit!important;
						line-height: inherit!important
					}
					tr.es-desk-hidden {
						display: table-row!important
					}
					table.es-desk-hidden {
						display: table!important
					}
					td.es-desk-menu-hidden {
						display: table-cell!important
					}
					.es-menu td {
						width: 1%!important
					}
					table.es-table-not-adapt,
					.esd-block-html table {
						width: auto!important
					}
					table.es-social {
						display: inline-block!important
					}
					table.es-social td {
						display: inline-block!important
					}
					.es-desk-hidden {
						display: table-row!important;
						width: auto!important;
						overflow: visible!important;
						max-height: inherit!important
					}
					.h-auto {
						height: auto!important
					}
				}
			</style>
		</head>

		<body style="width:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;font-family:arial, ''helvetica neue'', helvetica, sans-serif;padding:0;Margin:0">
			<div class="es-wrapper-color" style="background-color:#E4E5E7">
				<table class="es-wrapper" width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;padding:0;Margin:0;width:100%;height:100%;background-repeat:repeat;background-position:center top;background-color:#E4E5E7">
					<tr style="border-collapse:collapse">
						<td valign="top" style="padding:0;Margin:0">
							<table class="es-header" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%;background-color:transparent;background-repeat:repeat;background-position:center top">
								<tr style="border-collapse:collapse">
									<td align="center" style="padding:0;Margin:0">
										<table class="es-header-body" cellspacing="0" cellpadding="0" align="center" bgcolor="#094293" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#094293;width:600px">
											<tr style="border-collapse:collapse">
												<td align="left" style="padding:0;Margin:0;padding-top:20px;padding-left:20px;padding-right:20px">
													<table class="es-left" cellspacing="0" cellpadding="0" align="left" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;float:left">
														<tr style="border-collapse:collapse">
															<td class="es-m-p0r es-m-p20b" valign="top" align="center" style="padding:0;Margin:0;width:178px">
																
															</td>
														</tr>
													</table>
													<table cellspacing="0" cellpadding="0" align="right" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
														<tr style="border-collapse:collapse">
															<td align="left" style="padding:0;Margin:0;width:362px">
																<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
																	<tr style="border-collapse:collapse">
																		<td class="es-m-txt-c" align="right" style="padding:0;Margin:0;padding-top:15px;padding-bottom:20px">
																			<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#FFFFFF;font-size:14px">'+@fecha_solicitud+'</p>
																		</td>
																	</tr>
																</table>
															</td>
														</tr>
													</table>
												</td>
											</tr>
											<tr style="border-collapse:collapse">
												<td align="left" style="padding:0;Margin:0">
													<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
														<tr style="border-collapse:collapse">
															<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
																
															</td>
														</tr>
													</table>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>'

	SET @Alerta_Solicitud = 
		'<table class="es-content" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%">
			<tr style="border-collapse:collapse">
				<td align="center" style="padding:0;Margin:0">
					<table class="es-content-body" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#ededed;width:600px" cellspacing="0" cellpadding="0" bgcolor="#ededed" align="center">
						<tr style="border-collapse:collapse">
							<td align="left" style="padding:0;Margin:0">
								<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
									<tr style="border-collapse:collapse">
										<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
											<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
												<tr style="border-collapse:collapse">
													<td align="center" style="padding:0;Margin:0;padding-top:20px;padding-left:40px;padding-right:40px">
														<h1 style="Margin:0;line-height:31px;mso-line-height-rule:exactly;font-family:tahoma, verdana, segoe, sans-serif;font-size:26px;font-style:normal;font-weight:normal;color:#333333">Detalles Solicitud</h1>
														<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><br></p>
													</td>
												</tr>
												
												
												
											</table>
										</td>
									</tr>
								</table>
							</td>
						</tr>
						<tr style="border-collapse:collapse">
							<td align="left" style="padding:0;Margin:0">
								<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
									<tr style="border-collapse:collapse">
										<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
											
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>'

	SET @Encabezado_Correo = 
				'<table class="es-content" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%">
					<tr style="border-collapse:collapse">
						<td align="center" style="padding:0;Margin:0">
							<table class="es-content-body" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#ffffff;width:600px" cellspacing="0" cellpadding="0" bgcolor="#ffffff" align="center">
								<tr style="border-collapse:collapse">
									<td align="left" style="padding:0;Margin:0;padding-top:15px;padding-left:20px;padding-right:20px">
										<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
											<tr style="border-collapse:collapse">
												<td valign="top" align="center" style="padding:0;Margin:0;width:560px">
													
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<tr style="border-collapse:collapse">
									<td align="left" style="Margin:0;padding-top:20px;padding-left:20px;padding-right:20px;padding-bottom:25px">
										<table cellspacing="0" cellpadding="0" width="100%" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
											<tr style="border-collapse:collapse">
												<td align="left" style="padding:0;Margin:0;width:560px">
													<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
														
														<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>N�mero de solicitud: </strong> '+ @id_solicitud +'</p>
															</td>
														</tr>
														<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>Fecha solicitud : </strong> '+ @fecha_solicitud +'</p>
															</td>
														</tr>
														<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>Responsable de la solicitud: </strong> '+@responsable_solicitud+'</p>
															</td>
														</tr>

														<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>Tipo de Permiso: </strong> '+@tipo_solicitud+'</p>
															</td>
														</tr>

														<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>Horario Actual: </strong> '+@horario_actual+'</p>
															</td>
														</tr>

															<tr style="border-collapse:collapse">
															<td align="left" class="h-auto" height="30" style="padding:0;Margin:0">
																<p style="Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:arial, ''helvetica neue'', helvetica, sans-serif;line-height:21px;color:#333333;font-size:14px"><strong>Horario Nuevo: </strong> '+@horario_nuevo+'</p>
															</td>
														</tr>

													</table>
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<tr style="border-collapse:collapse">
									<td style="padding:0;Margin:0;background-color:#ededed" bgcolor="#ededed" align="left">
										<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
											<tr style="border-collapse:collapse">
												<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
													
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>'
											
	SET @EncabezadoAprobacion = 
	'<table class="es-content" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%">
		<tr style="border-collapse:collapse">
			<td align="center" style="padding:0;Margin:0">
				<table class="es-content-body" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#ededed;width:600px" cellspacing="0" cellpadding="0" bgcolor="#ededed" align="center">
					<tr style="border-collapse:collapse">
						<td align="left" style="Margin:0;padding-top:20px;padding-bottom:20px;padding-left:40px;padding-right:40px">
							<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
								<tr style="border-collapse:collapse">
									<td align="left" style="padding:0;Margin:0;width:520px">
										<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
											<tr style="border-collapse:collapse">
												<td class="h-auto" align="center" height="30" style="padding:0;Margin:0">
													<h3 style="Margin:0;line-height:24px;mso-line-height-rule:exactly;font-family:tahoma, verdana, segoe, sans-serif;font-size:20px;font-style:normal;font-weight:normal;color:#333333">Aprobaciones:</h3>
												</td>
											</tr>
											<tr style="border-collapse:collapse">
												<td style="padding:0;Margin:0">
													<table style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
														<tr style="border-collapse:collapse">
															<th></th>
														</tr>
													</table>
												</td>
											</tr>
											<tr style="border-collapse:collapse">
												<td align="center" style="padding:0;Margin:0;padding-top:10px;padding-bottom:10px">
													<table border="1" align="center" cellspacing="1" cellpadding="3" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;height:70px;width:500px" class="es-table">
														<thead>
															<tr style="border-collapse:collapse">
																<th style="font-size:12px;text-align:center;color:#000000" scope="col">Departamento</th>
																<th style="font-size:12px;text-align:center;color:#000000" scope="col">Encargado</th>
																<th style="font-size:12px;text-align:center;color:#000000" scope="col">Secuencia</th>
																<th style="font-size:12px;text-align:center;color:#000000" scope="col">Estado</th>
															</tr>
														</thead>
														<tr style="border-collapse:collapse">'

	SET @TableAprobacion = 
		(SELECT DEPAP.DESCRIPCION AS [TD] ,EMPLE.NOMBRECOMPLETO AS [TD], APSOLI.SECUENCIA AS [TD],   CASE APSOLI.RESPUESTA_SOLICITUD
When 'P' Then 'PENDIENTE'
When 'A' Then 'APROBADO'
ELSE 'RECHAZADO' 
END  AS [TD] FROM APROBACIONSOLICITUD APSOLI
INNER JOIN EMPLEADO EMPLE ON APSOLI.ENCARGADO_APROBACION_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTOSUPERVISOR DEPASUP ON DEPASUP.EMPLEADO_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTO DEPAP ON DEPAP.ID_DEPARTAMENTO=DEPASUP.DEPARTAMENTO_ID

WHERE APSOLI.SOLICITUD_ID=@id_solicitud		

order by APSOLI.SECUENCIA ASC
		FOR XML RAW('tr'), ELEMENTS) + '
														</tr>
													</table>
												</td>
											</tr>
											<tr style="border-collapse:collapse">
												<td class="h-auto" align="center" height="30" style="padding:0;Margin:0">
													<h3 style="Margin:0;line-height:24px;mso-line-height-rule:exactly;font-family:tahoma, verdana, segoe, sans-serif;font-size:20px;font-style:normal;font-weight:normal;color:#333333"><br></h3>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>'


	SET @APROBACION = '
						<tr>
                          <td>
                            <table cellpadding="0" cellspacing="0" width="100%" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
                              <tr>
                                <td align="center" valign="top" style="padding:0;Margin:0;width:560px">
                                  <table cellpadding="0" cellspacing="0" width="100%" role="presentation" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
                                    <tr>
                                      <td align="center" style="padding:0;Margin:0;padding-top:15px;padding-bottom:15px">
                                        <span class="es-button-border" style="border-style:solid;color:#FFFFFF;border-color:#094293;background:#094293;border-width:4px;display:inline-block;border-radius:10px;width:auto">
										  
                                            Ingrese al m�dulo Gesti�n de Personal a consultar los detalles del registro del permiso
											
									    </span>
									  </td>
                                    </tr>
                                  </table>
                                </td>
                              </tr>
                            </table>
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
					'

	SET @footer = 
		'<table class="es-content" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%">
			<tr style="border-collapse:collapse">
				<td align="center" style="padding:0;Margin:0">
					<table class="es-content-body" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:#ededed;width:600px" cellspacing="0" cellpadding="0" bgcolor="#ededed" align="center">
						<tr style="border-collapse:collapse">
							<td align="left" style="padding:0;Margin:0">
								<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
									<tr style="border-collapse:collapse">
										<td valign="top" align="center" style="padding:0;Margin:0;width:600px">
											
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
		<table cellpadding="0" cellspacing="0" class="es-footer" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%;background-color:transparent;background-repeat:repeat;background-position:center top">
			<tr style="border-collapse:collapse">
				<td align="center" style="padding:0;Margin:0">
					<table class="es-footer-body" cellspacing="0" cellpadding="0" align="center" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:transparent;width:600px">
						<tr style="border-collapse:collapse">
							<td align="left" bgcolor="#094293" style="padding:0;Margin:0;padding-top:20px;padding-left:20px;padding-right:20px;background-color:#094293">
								<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
									<tr style="border-collapse:collapse">
										<td valign="top" align="center" style="padding:0;Margin:0;width:560px">
											<table width="100%" cellspacing="0" cellpadding="0" style="mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px">
												<tr style="border-collapse:collapse">
												</tr>
											</table>
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
						</td>
					</tr>
				</table>
			</div>
		</body>
	</html> '


	
		SET  @MENSAJE_SOLICITUD =	@INICIO_CORREO			+ @Alerta_Solicitud			+ @Encabezado_Correo	+
								   	+  @EncabezadoAprobacion	+ @TableAprobacion		+ @footer
	
	    SET  @MENSAJE_APROBACION=	@INICIO_CORREO			+ @Alerta_Solicitud			+ @Encabezado_Correo	+
								 	+  @EncabezadoAprobacion	+ @TableAprobacion		+@APROBACION+ @footer
 
	
		IF @Email_Usuario <> ''
			BEGIN
				EXEC msdb.dbo.sp_send_dbmail
					@profile_name = 'EnvioMail',
					@recipients =  @Email_Usuario,
					@subject = 'NOTIFICACION-REGISTRO DE PERMISO',
					@body =  @MENSAJE_SOLICITUD,
					@body_format = 'HTML';
			END

			IF @Email_Usuario <> ''
			BEGIN
				EXEC msdb.dbo.sp_send_dbmail
					@profile_name = 'EnvioMail',
					@recipients =  @Email_Usuario_aprobar,
					@subject = 'REGISTRO DE PERMISO PARA APROBACION',
					@body =  @MENSAJE_APROBACION,
					@body_format = 'HTML';
			END

	select @responsable_solicitud
	select @MENSAJE_SOLICITUD
	select @Email_Usuario

    SET @Resultado = 1

end
	
	
	
	
END TRY
BEGIN CATCH
	
  INSERT INTO [dbo].[DB_ERRORES]
           ([UserName]
           ,[ErrorNumber]
           ,[ErrorState]
           ,[ErrorSeverity]
           ,[ErrorLine]
           ,[ErrorProcedure]
           ,[ErrorMessage]
           ,[ErrorDateTime])

    VALUES
  (SUSER_SNAME(),
   ERROR_NUMBER(),
   ERROR_STATE(),
   ERROR_SEVERITY(),
   ERROR_LINE(),
   ERROR_PROCEDURE(),
   ERROR_MESSAGE(),
   GETDATE());
END CATCH
GO
/****** Object:  StoredProcedure [dbo].[ObtenerDireccionesPorEmpleado]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/23/2024
-- Description: Lista todas las direcciones de un empleado
-- =============================================
CREATE PROCEDURE [dbo].[ObtenerDireccionesPorEmpleado]
(
    -- Add the parameters for the stored procedure here
    @ID_EMPLEADO BIGINT
)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here
        SELECT 
        D.ID_DIRECCION,
        D.DIRRECION
    FROM 
        [dbo].[DIRRECCION] D
    INNER JOIN 
        [dbo].[EMPLEADODIRRECCION] ED ON D.ID_DIRECCION = ED.DIRRECION_ID
    WHERE 
        ED.EMPLEADO_ID = @ID_EMPLEADO;
END
GO
/****** Object:  StoredProcedure [dbo].[ObtenerHorarioLaboralEmpleado]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create proc [dbo].[ObtenerHorarioLaboralEmpleado] 
  @Correo varchar(256) 
  as begin

  select hl.ID_HORARIOLABORAL,   CONCAT(hl.DESCRIPCION, ' - ', CONVERT(varchar(5), hl.HORA_INGRESO, 108), ' hasta ', CONVERT(varchar(5), hl.HORA_SALIDA, 108)) AS HORARIO from empleado emple 
  inner join HORARIOLABORAL hl on hl.ID_HORARIOLABORAL=emple.HORARIOLABORAL_ID
  INNER JOIN CORREO CO ON CO.ID_CORREO=emple.CORREO_ID
  where co.CORREO=@Correo
  end

  -- =======================================================
-- Create Stored Procedure Template for Azure SQL Database
-- =======================================================
SET ANSI_NULLS ON
GO
/****** Object:  StoredProcedure [dbo].[ObtenerHorariosDisponibles]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create PROC [dbo].[ObtenerHorariosDisponibles]
    @id_empleado bigint
AS
BEGIN
    DECLARE @horario_actual bigint;

    
    SET @horario_actual = (SELECT HORARIOLABORAL_ID FROM EMPLEADO WHERE ID_EMPLEADO = @id_empleado);

   
    SELECT 
        ID_HORARIOLABORAL, 
        CONCAT(NOMBREHL, ' - ', CONVERT(varchar(5), HORA_INGRESO, 108), ' hasta ', CONVERT(varchar(5), HORA_SALIDA, 108)) AS Horario
    FROM 
        HORARIOLABORAL
    WHERE 
        ID_HORARIOLABORAL != @horario_actual;
END;

GO
/****** Object:  StoredProcedure [dbo].[ObtenerInformacionEmpleado]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[ObtenerInformacionEmpleado]
as begin
SELECT 
    em.IDENTIFICACION,
    em.NOMBRECOMPLETO,
    em.FECHA_NACIMIENTO,
    em.FOTO,
    co.CORREO,
    roles.Name as ROL,
    de.DESCRIPCION AS DEPARTAMENTO,
    ca.NOMBRE_CARGO AS CARGO,
    ho.DESCRIPCION AS HORARIO,
    em.SALARIO,
    em.SALDO_VACACIONES,
    STRING_AGG(direc.DIRRECION, ',') AS DIRRECIONES,
	STRING_AGG(tel.TELEFONO, ', ') AS TELEFONOS,
	em.ESTADO
FROM 
    EMPLEADO em
LEFT JOIN 
    CARGO ca ON em.CARGO_ID = ca.ID_CARGO
INNER JOIN 
    CORREO co ON co.ID_CORREO = em.CORREO_ID
LEFT JOIN  
    HORARIOLABORAL ho ON ho.ID_HORARIOLABORAL = em.HORARIOLABORAL_ID
LEFT JOIN 
    DEPARTAMENTO de ON de.ID_DEPARTAMENTO = em.DEPARTAMENTO_ID
INNER JOIN 
    AspNetUsers users ON users.Email = co.CORREO
INNER JOIN 
    AspNetUserRoles userol ON userol.UserId = users.Id
INNER JOIN 
    AspNetRoles roles ON roles.Id = userol.RoleId
LEFT JOIN 
    EMPLEADODIRRECCION empledirec ON empledirec.EMPLEADO_ID = em.ID_EMPLEADO
LEFT JOIN 
    DIRRECCION direc ON direc.ID_DIRECCION = empledirec.DIRRECION_ID

	LEFT JOIN EMPLEADOTELEFONO empletel on empletel.EMPLEADO_ID=em.ID_EMPLEADO

	LEFT join TELEFONO tel on tel.ID_TELEFONO=empletel.TELEFONO_ID
GROUP BY 
    em.IDENTIFICACION,
    em.NOMBRECOMPLETO,
    em.FECHA_NACIMIENTO,
    em.FOTO,
    co.CORREO,
    roles.Name,
    de.DESCRIPCION,
    ca.NOMBRE_CARGO,
    ho.DESCRIPCION,
    em.SALARIO,
    em.SALDO_VACACIONES,
	em.ESTADO
	END
GO
/****** Object:  StoredProcedure [dbo].[ObtenerSolicitudesEmpleados]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

  create PROCEDURE [dbo].[ObtenerSolicitudesEmpleados] 
    @id_empleado BIGINT
AS
BEGIN
    SELECT 
        soli.FECHA_SOLICITUD,
        emp.NOMBRECOMPLETO,
        emp.IDENTIFICACION,
        tiposoli.NOMBRE_TIPO_SOLICITUD,
        CASE soli.ESTADO_SOLICITUD
            WHEN 'P' THEN 'PENDIENTE'
            WHEN 'A' THEN 'APROBADO'
            WHEN 'R' THEN 'RECHAZADO'
        END AS ESTADO
    FROM 
        SOLICITUD soli
    INNER JOIN 
        EMPLEADO emp ON emp.ID_EMPLEADO = soli.SOLICITANTE_ID
    INNER JOIN 
        TIPOSOLICITUD tiposoli ON tiposoli.ID_TIPOSOLICITUD = soli.TIPOSOLICITUD_ID

		

    WHERE 
        emp.ID_EMPLEADO = @id_empleado

		order by soli.FECHA_SOLICITUD desc
		
END;

GO
/****** Object:  StoredProcedure [dbo].[ObtenerTelefonosPorEmpleado]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Wilson Arias
-- Create Date: 06/23/2024
-- Description: Lista todos los telefonos que tenga un empleado
-- =============================================
CREATE PROCEDURE [dbo].[ObtenerTelefonosPorEmpleado]
(
    -- Add the parameters for the stored procedure here
    @ID_EMPLEADO BIGINT
)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON

    -- Insert statements for procedure here
    SELECT 
        T.ID_TELEFONO,
        T.TELEFONO
    FROM 
        [dbo].[TELEFONO] T
    INNER JOIN 
        [dbo].[EMPLEADOTELEFONO] ET ON T.ID_TELEFONO = ET.TELEFONO_ID
    WHERE 
        ET.EMPLEADO_ID = @ID_EMPLEADO;
END
GO
/****** Object:  StoredProcedure [dbo].[ObtenerTelefonosUsuario]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE   PROCEDURE [dbo].[ObtenerTelefonosUsuario]
@ID_EMPLEADO BIGINT
AS
BEGIN
	SELECT t.ID_TELEFONO AS ID_TELEFONO, t.TELEFONO AS TELEFONO
    FROM EMPLEADOTELEFONO et
    INNER JOIN TELEFONO t ON et.TELEFONO_ID = t.ID_TELEFONO
    WHERE et.EMPLEADO_ID = @ID_EMPLEADO
END
GO
/****** Object:  StoredProcedure [dbo].[ObtenerTiposSolicitudes]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE    PROC [dbo].[ObtenerTiposSolicitudes]
as begin

select ID_TIPOSOLICITUD AS ID, NOMBRE_TIPO_SOLICITUD AS DESCRIPCION from TIPOSOLICITUD

where ID_TIPOSOLICITUD in (1,2,3)


end
GO
/****** Object:  StoredProcedure [dbo].[RegistrarAprobaciones]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[RegistrarAprobaciones] 
    @ID_SOLICITUD bigint
AS 
BEGIN
    -- Declaraci�n de variables
    DECLARE @ENCARGADO_APROBACION bigint;
    DECLARE @SECUENCIA varchar(200);
    DECLARE @RESPUESTA_SOLICITUD varchar(1) = 'P'; 

    BEGIN TRY
        -- Declaraci�n del cursor
        DECLARE cursorAprobaciones CURSOR FOR
        SELECT d.SECUENCIA, e.EMPLEADO_ID
        FROM [dbo].[SOLICITUD] a 
        INNER JOIN [dbo].[EMPLEADO] b ON a.SOLICITANTE_ID = b.ID_EMPLEADO
        INNER JOIN DEPARTAMENTO c ON c.ID_DEPARTAMENTO = b.DEPARTAMENTO_ID
        INNER JOIN FLUJOAPROBACION d ON d.DEPARTAMENTO_APROBACION_ID = c.ID_DEPARTAMENTO
        INNER JOIN [dbo].[DEPARTAMENTOSUPERVISOR] e ON e.DEPARTAMENTO_ID = d.DEPARTAMENTO_ID
        WHERE a.ID_SOLICITUD = @ID_SOLICITUD;

        -- Apertura del cursor
        OPEN cursorAprobaciones;

        -- Obtenci�n del primer registro
        FETCH NEXT FROM cursorAprobaciones INTO @SECUENCIA, @ENCARGADO_APROBACION;

        -- Bucle para manejar los datos obtenidos del cursor
        WHILE @@FETCH_STATUS = 0
        BEGIN
            -- Insertar datos en la tabla APROBACIONSOLICITUD
            INSERT INTO APROBACIONSOLICITUD(
               SECUENCIA,
               RESPUESTA_SOLICITUD,
               ENCARGADO_APROBACION_ID,
               SOLICITUD_ID
             
            )
            VALUES (
               @SECUENCIA,
               @RESPUESTA_SOLICITUD,
               @ENCARGADO_APROBACION,
               @ID_SOLICITUD
        
            );

            -- Obtenci�n del siguiente registro
            FETCH NEXT FROM cursorAprobaciones INTO @SECUENCIA, @ENCARGADO_APROBACION;
        END;

        -- Cierre del cursor
        CLOSE cursorAprobaciones;
        DEALLOCATE cursorAprobaciones;

	--	 exec [dbo].[NotificacionSolicitud]  @ID_SOLICITUD

    END TRY
    BEGIN CATCH
        INSERT INTO [dbo].[DB_ERRORES]
           ([UserName],
            [ErrorNumber],
            [ErrorState],
            [ErrorSeverity],
            [ErrorLine],
            [ErrorProcedure],
            [ErrorMessage],
            [ErrorDateTime])
        VALUES
          (SUSER_SNAME(),
           ERROR_NUMBER(),
           ERROR_STATE(),
           ERROR_SEVERITY(),
           ERROR_LINE(),
           ERROR_PROCEDURE(),
           ERROR_MESSAGE(),
           GETDATE());
    END CATCH;
END;
GO
/****** Object:  StoredProcedure [dbo].[RegistrarSolicitud]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[RegistrarSolicitud]
  @FECHA_INICIO datetime,
  @FECHA_FINAL datetime,
  @COMENTARIO varchar(max),
  @DETALLE varchar(max),
  @SOLICITANTE_ID bigint,
  @TIPOSOLICITUD_ID bigint
AS
BEGIN

  BEGIN TRY
  DECLARE @ID_SOLICITUD BIGINT

  IF (@TIPOSOLICITUD_ID IN (1, 2, 3))
  BEGIN
  DECLARE @DIAS INT
  DECLARE @SALDO_DISPONIBLE BIGINT
SET @DIAS=[dbo].[CalcularDias](@FECHA_INICIO,@FECHA_FINAL);
SET @SALDO_DISPONIBLE=( SELECT SALDO_VACACIONES FROM EMPLEADO WHERE ID_EMPLEADO=@SOLICITANTE_ID)

IF(@SALDO_DISPONIBLE>=@DIAS)
BEGIN
    -- Insert the new solicitud record
    INSERT INTO SOLICITUD (
        FECHA_SOLICITUD,
        FECHA_INICIO,
        FECHA_FINAL,
        COMENTARIO,
        DIAS,
        DETALLE,
        ESTADO_SOLICITUD,
        SOLICITANTE_ID,
        TIPOSOLICITUD_ID
    ) VALUES (
        GETDATE(),
        @FECHA_INICIO,
        @FECHA_FINAL,
        @COMENTARIO,
        @DIAS,
        @DETALLE,
        'P',
        @SOLICITANTE_ID,
        @TIPOSOLICITUD_ID
    );
  END
  SET @ID_SOLICITUD=SCOPE_IDENTITY()
  exec [dbo].[RegistrarAprobaciones] @ID_SOLICITUD
  END
  ELSE
  BEGIN
 
    PRINT 'El tipo de solicitud ';
  END
END TRY
BEGIN CATCH
  INSERT INTO [dbo].[DB_ERRORES]
           ([UserName]
           ,[ErrorNumber]
           ,[ErrorState]
           ,[ErrorSeverity]
           ,[ErrorLine]
           ,[ErrorProcedure]
           ,[ErrorMessage]
           ,[ErrorDateTime])

    VALUES
  (SUSER_SNAME(),
   ERROR_NUMBER(),
   ERROR_STATE(),
   ERROR_SEVERITY(),
   ERROR_LINE(),
   ERROR_PROCEDURE(),
   ERROR_MESSAGE(),
   GETDATE());
END CATCH;
END
GO
/****** Object:  StoredProcedure [dbo].[RegistrarSolicitudCambioHorario]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE proc [dbo].[RegistrarSolicitudCambioHorario] 
  @COMENTARIO varchar(max),
  @DETALLE varchar(max),
  @SOLICITANTE_ID bigint,
  @ID_HORARIOLABORAL bigint
  

  as begin

  DECLARE @ID_SOLICITUD BIGINT

   BEGIN TRY
  insert into SOLICITUD(FECHA_SOLICITUD, COMENTARIO, DETALLE, ESTADO_SOLICITUD, SOLICITANTE_ID,TIPOSOLICITUD_ID,ID_HORARIOLABORAL)
  VALUES( GETDATE(), @COMENTARIO,@DETALLE,'P',@SOLICITANTE_ID,4,@ID_HORARIOLABORAL)

  SET @ID_SOLICITUD=SCOPE_IDENTITY()
  exec [dbo].[RegistrarAprobaciones] @ID_SOLICITUD
   
END TRY
BEGIN CATCH

INSERT INTO [dbo].[DB_ERRORES]
           ([UserName]
           ,[ErrorNumber]
           ,[ErrorState]
           ,[ErrorSeverity]
           ,[ErrorLine]
           ,[ErrorProcedure]
           ,[ErrorMessage]
           ,[ErrorDateTime])

    VALUES
  (SUSER_SNAME(),
   ERROR_NUMBER(),
   ERROR_STATE(),
   ERROR_SEVERITY(),
   ERROR_LINE(),
   ERROR_PROCEDURE(),
   ERROR_MESSAGE(),
   GETDATE());
END CATCH;

  END

GO
/****** Object:  Trigger [dbo].[trg_AfterInsert_AspNetUsers]    Script Date: 6/29/2024 4:38:57 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create TRIGGER [dbo].[trg_AfterInsert_AspNetUsers]
ON [dbo].[AspNetUsers]
AFTER INSERT
AS
BEGIN
BEGIN TRY
    -- Validar si el correo existe
    IF NOT EXISTS (
        SELECT 1
        FROM CORREO C
        INNER JOIN INSERTED I ON C.CORREO = I.Email
    )
    BEGIN
        -- Insertar el correo en la tabla CORREO solo si no existe
        INSERT INTO CORREO (CORREO)
        SELECT DISTINCT Email 
        FROM INSERTED;
    END
    -- Insertar en la tabla EMPLEADO con el CORREO_ID correspondiente al correo.
    INSERT INTO EMPLEADO (CORREO_ID, ESTADO, AspNetUsers_ID)
    SELECT C.ID_CORREO, 1, ASP.Id
    FROM CORREO C
    INNER JOIN INSERTED I ON C.CORREO = I.Email
    INNER JOIN [AspNetUsers] ASP ON ASP.Email = I.Email;
    -- Insertar en la tabla AspNetUserRoles con el ROL 1 (Empleado)
    INSERT INTO AspNetUserRoles (UserId, RoleId)
    SELECT I.Id, 1
    FROM INSERTED I;
 
    -- Insertar los teléfonos (reemplaza '<TELEFONO1>' y '<TELEFONO2>' con los valores reales)
    DECLARE @Telefono1ID BIGINT;
    DECLARE @Telefono2ID BIGINT;
    DECLARE @EmpleadoID BIGINT;
 
    -- Obtener el ID del nuevo empleado
    SELECT @EmpleadoID = E.ID_EMPLEADO
    FROM EMPLEADO E
    INNER JOIN INSERTED I ON E.AspNetUsers_ID = I.Id;
 
    
    INSERT INTO TELEFONO (TELEFONO)
    VALUES ('000 000 000');
 
   
    SET @Telefono1ID = SCOPE_IDENTITY();
 
   
    INSERT INTO TELEFONO (TELEFONO)
    VALUES ('000 000 000');
 
    
    SET @Telefono2ID = SCOPE_IDENTITY();
 
   
    INSERT INTO EMPLEADOTELEFONO (EMPLEADO_ID, TELEFONO_ID)
    VALUES (@EmpleadoID, @Telefono1ID);
 
    
    INSERT INTO EMPLEADOTELEFONO (EMPLEADO_ID, TELEFONO_ID)
    VALUES (@EmpleadoID, @Telefono2ID);
 
END TRY
BEGIN CATCH
    INSERT INTO [dbo].[DB_ERRORES]
           ([UserName]
           ,[ErrorNumber]
           ,[ErrorState]
           ,[ErrorSeverity]
           ,[ErrorLine]
           ,[ErrorProcedure]
           ,[ErrorMessage]
           ,[ErrorDateTime])
    VALUES
    (SUSER_SNAME(),
    ERROR_NUMBER(),
    ERROR_STATE(),
    ERROR_SEVERITY(),
    ERROR_LINE(),
    ERROR_PROCEDURE(),
    ERROR_MESSAGE(),
    GETDATE());
END CATCH
END;
GO
ALTER TABLE [dbo].[AspNetUsers] ENABLE TRIGGER [trg_AfterInsert_AspNetUsers]
GO
CREATE PROC ObtenerAprobacionFlujo 
@id_solicitud bigint
as begin
SELECT DEPAP.DESCRIPCION AS DEPARTAMENTO ,EMPLE.NOMBRECOMPLETO , 
AP.SECUENCIA ,  CASE AP.RESPUESTA_SOLICITUD
When 'P' Then 'PENDIENTE'
When 'A' Then 'APROBADO'
ELSE 'RECHAZADO' 
END  AS RESPUESTASOLICITUD FROM APROBACIONSOLICITUD AP
INNER JOIN EMPLEADO EMPLE ON AP.ENCARGADO_APROBACION_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTOSUPERVISOR DEPASUP ON DEPASUP.EMPLEADO_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTO DEPAP ON DEPAP.ID_DEPARTAMENTO=DEPASUP.DEPARTAMENTO_ID

WHERE AP.SOLICITUD_ID=@id_solicitud
end
GO
create PROCEDURE [dbo].[ObtenerAprobacionPendiente]  
@ID_EMPLEADO BIGINT
AS
BEGIN

SELECT 
    SOLI.ID_SOLICITUD, 
	SOLI.FECHA_SOLICITUD,
    EMPLEPER.NOMBRECOMPLETO AS SOLICITANTE, 
    EMPLEPER.IDENTIFICACION, 
    TIPO.DESCRIPCION AS TIPOPERMISO,
    ISNULL(HL.NOMBREHL,'') AS HORARIO,
    ISNULL(SOLI.DIAS,'') AS DIAS,
	
    CASE 
        WHEN AP.RESPUESTA_SOLICITUD = 'P' THEN 'PENDIENTE'
        WHEN AP.RESPUESTA_SOLICITUD = 'A' THEN 'APROBADO'
        ELSE 'RECHAZADO'
    END AS RESPUESTASOLICITUD 
FROM 
    APROBACIONSOLICITUD AP
INNER JOIN 
    EMPLEADO EMPLE ON AP.ENCARGADO_APROBACION_ID = EMPLE.ID_EMPLEADO
INNER JOIN 
    DEPARTAMENTOSUPERVISOR DEPASUP ON DEPASUP.EMPLEADO_ID = EMPLE.ID_EMPLEADO
INNER JOIN 
    DEPARTAMENTO DEPAP ON DEPAP.ID_DEPARTAMENTO = DEPASUP.DEPARTAMENTO_ID
INNER JOIN 
    SOLICITUD SOLI ON SOLI.ID_SOLICITUD = AP.SOLICITUD_ID
INNER JOIN 
    EMPLEADO EMPLEPER ON EMPLEPER.ID_EMPLEADO = SOLI.SOLICITANTE_ID
INNER JOIN 
    TIPOSOLICITUD TIPO ON TIPO.ID_TIPOSOLICITUD = SOLI.TIPOSOLICITUD_ID

LEFT JOIN HORARIOLABORAL HL ON HL.ID_HORARIOLABORAL=SOLI.ID_HORARIOLABORAL
WHERE 
    AP.ENCARGADO_APROBACION_ID = @ID_EMPLEADO
    AND AP.RESPUESTA_SOLICITUD = 'P' 
    AND NOT EXISTS (
        SELECT 1 
        FROM APROBACIONSOLICITUD AP2 
        WHERE AP2.SOLICITUD_ID = AP.SOLICITUD_ID 
          AND AP2.SECUENCIA < AP.SECUENCIA 
          AND AP2.RESPUESTA_SOLICITUD <> 'A'
    )

END
go
create PROCEDURE [dbo].[ObtenerAprobacionPendienteDetalle]  
@ID_SOLICITUD BIGINT,
@ID_EMPLEADO BIGINT
as begin


SELECT SOLI.ID_SOLICITUD, 
EMPLEPER.NOMBRECOMPLETO AS SOLICITANTE ,
EMPLEPER.IDENTIFICACION ,
TIPO.DESCRIPCION AS TIPOPERMISO
,ISNULL(SOLI.DIAS,'') AS DIAS,
CASE AP.RESPUESTA_SOLICITUD
When 'P' Then 'PENDIENTE' 
When 'A' Then 'APROBADO'
ELSE 'RECHAZADO' 
END   RESPUESTASOLICITUD ,
SOLI.FECHA_SOLICITUD,
ISNULL(FECHA_INICIO, '') AS FECHAINICIO,
ISNULL(FECHA_FINAL,'') AS FECHAFINAL, 
SOLI.COMENTARIO
,SOLI.DETALLE,ap.SECUENCIA, 
HL.DESCRIPCION AS HORARIONUEVO,
HOL.NOMBREHL AS HORARIOACTUAL

FROM APROBACIONSOLICITUD AP
INNER JOIN EMPLEADO EMPLE ON AP.ENCARGADO_APROBACION_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTOSUPERVISOR DEPASUP ON DEPASUP.EMPLEADO_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTO DEPAP ON DEPAP.ID_DEPARTAMENTO=DEPASUP.DEPARTAMENTO_ID
INNER JOIN SOLICITUD SOLI ON SOLI.ID_SOLICITUD=AP.SOLICITUD_ID
INNER JOIN EMPLEADO EMPLEPER ON EMPLEPER.ID_EMPLEADO=SOLI.SOLICITANTE_ID
INNER JOIN TIPOSOLICITUD TIPO ON TIPO.ID_TIPOSOLICITUD=SOLI.ID_SOLICITUD
LEFT JOIN HORARIOLABORAL HL ON HL.ID_HORARIOLABORAL=SOLI.ID_HORARIOLABORAL
LEFT JOIN HORARIOLABORAL HOL ON HOL.ID_HORARIOLABORAL=EMPLE.HORARIOLABORAL_ID

WHERE SOLI.ID_SOLICITUD=@ID_SOLICITUD and  AP.ENCARGADO_APROBACION_ID=@ID_EMPLEADO

END

go

ALTER PROCEDURE [dbo].[ObtenerAprobacionPendienteDetalle]  
@ID_SOLICITUD BIGINT,
@ID_EMPLEADO BIGINT
as begin


SELECT SOLI.ID_SOLICITUD, 
EMPLEPER.NOMBRECOMPLETO AS SOLICITANTE ,
EMPLEPER.IDENTIFICACION ,
TIPO.DESCRIPCION AS TIPOPERMISO
,ISNULL(SOLI.DIAS,'') AS DIAS,
CASE AP.RESPUESTA_SOLICITUD
When 'P' Then 'PENDIENTE' 
When 'A' Then 'APROBADO'
ELSE 'RECHAZADO' 
END   RESPUESTASOLICITUD ,
SOLI.FECHA_SOLICITUD,
ISNULL(FECHA_INICIO, '') AS FECHAINICIO,
ISNULL(FECHA_FINAL,'') AS FECHAFINAL, 
SOLI.COMENTARIO
,SOLI.DETALLE,ap.SECUENCIA, 
ISNULL(HL.NOMBREHL ,'') AS HORARIONUEVO,
HOL.NOMBREHL AS HORARIOACTUAL

FROM APROBACIONSOLICITUD AP
INNER JOIN EMPLEADO EMPLE ON AP.ENCARGADO_APROBACION_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTOSUPERVISOR DEPASUP ON DEPASUP.EMPLEADO_ID=EMPLE.ID_EMPLEADO
INNER JOIN DEPARTAMENTO DEPAP ON DEPAP.ID_DEPARTAMENTO=DEPASUP.DEPARTAMENTO_ID
INNER JOIN SOLICITUD SOLI ON SOLI.ID_SOLICITUD=AP.SOLICITUD_ID
INNER JOIN EMPLEADO EMPLEPER ON EMPLEPER.ID_EMPLEADO=SOLI.SOLICITANTE_ID
INNER JOIN TIPOSOLICITUD TIPO ON TIPO.ID_TIPOSOLICITUD=SOLI.TIPOSOLICITUD_ID
LEFT JOIN HORARIOLABORAL HL ON HL.ID_HORARIOLABORAL=SOLI.ID_HORARIOLABORAL
LEFT JOIN HORARIOLABORAL HOL ON HOL.ID_HORARIOLABORAL=EMPLE.HORARIOLABORAL_ID

WHERE SOLI.ID_SOLICITUD=@ID_SOLICITUD and  AP.ENCARGADO_APROBACION_ID=@ID_EMPLEADO

END